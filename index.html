<!DOCTYPE html>
<html lang="zh-CN,en,default">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/snail-filled.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/snail-filled-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/snail-filled-16x16.png">
  <link rel="mask-icon" href="/images/snail-filled.png" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"moakap.github.io","root":"/","scheme":"Mist","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":"valine","storage":true,"lazyload":false,"nav":null,"activeClass":"valine"},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta property="og:type" content="website">
<meta property="og:title" content="Moakap&#39;s Blog">
<meta property="og:url" content="https://moakap.github.io/index.html">
<meta property="og:site_name" content="Moakap&#39;s Blog">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="moakap">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://moakap.github.io/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

  <title>Moakap's Blog</title>
  
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-DFB6WMHQPG"></script>
    <script>
      if (CONFIG.hostname === location.hostname) {
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-DFB6WMHQPG');
      }
    </script>






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Moakap's Blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">Keep moving, keep thinking!</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签<span class="badge">32</span></a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类<span class="badge">10</span></a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档<span class="badge">20</span></a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN,en,default">
    <link itemprop="mainEntityOfPage" href="https://moakap.github.io/2023/06/08/superficial/Install_RAP2_in_Ubuntu/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/snail-filled.png">
      <meta itemprop="name" content="moakap">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Moakap's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/06/08/superficial/Install_RAP2_in_Ubuntu/" class="post-title-link" itemprop="url">ubuntu下安装和部署RAP2</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2023-06-08 15:15:51" itemprop="dateCreated datePublished" datetime="2023-06-08T15:15:51+00:00">2023-06-08</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%9C%BB%E8%9C%93%E7%82%B9%E6%B0%B4/" itemprop="url" rel="index"><span itemprop="name">蜻蜓点水</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%9C%BB%E8%9C%93%E7%82%B9%E6%B0%B4/RAP2/" itemprop="url" rel="index"><span itemprop="name">RAP2</span></a>
                </span>
            </span>

          
            <span id="/2023/06/08/superficial/Install_RAP2_in_Ubuntu/" class="post-meta-item leancloud_visitors" data-flag-title="ubuntu下安装和部署RAP2" title="阅读次数">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/2023/06/08/superficial/Install_RAP2_in_Ubuntu/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2023/06/08/superficial/Install_RAP2_in_Ubuntu/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="ubuntu下安装和部署RAP2"><a href="#ubuntu下安装和部署RAP2" class="headerlink" title="ubuntu下安装和部署RAP2"></a>ubuntu下安装和部署RAP2</h1><h2 id="1-后台部署"><a href="#1-后台部署" class="headerlink" title="1. 后台部署"></a>1. 后台部署</h2><h3 id="1-1-安装mysql和redis"><a href="#1-1-安装mysql和redis" class="headerlink" title="1.1 安装mysql和redis"></a>1.1 安装mysql和redis</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ sudo apt update</span><br><span class="line">$ sudo apt install mysql-server</span><br><span class="line">$ sudo apt install redis-server</span><br></pre></td></tr></table></figure>

<h3 id="1-2-安装pandoc"><a href="#1-2-安装pandoc" class="headerlink" title="1.2 安装pandoc"></a>1.2 安装pandoc</h3><p>1.2.1 从<a target="_blank" rel="noopener" href="https://github.com/jgm/pandoc/releases">pandoc release下载页面</a>下载最新版本</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ wget https://github.com/jgm/pandoc/releases/download/3.1/pandoc-3.1-1-amd64.deb</span><br></pre></td></tr></table></figure>

<p>1.2.2 安装</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$ sudo dpkg -i pandoc-3.1-1-amd64.deb</span><br><span class="line">$ pandoc -v</span><br><span class="line">pandoc 3.1</span><br><span class="line">Features: +server +lua</span><br><span class="line">Scripting engine: Lua 5.4</span><br><span class="line">User data directory: /home/ubuntu/.local/share/pandoc</span><br><span class="line">Copyright (C) 2006-2023 John MacFarlane. Web:  https://pandoc.org</span><br><span class="line">This is free software; see the source for copying conditions. There is no</span><br><span class="line">warranty, not even for merchantability or fitness for a particular purpose.</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="1-3-安装nodejs和npm"><a href="#1-3-安装nodejs和npm" class="headerlink" title="1.3 安装nodejs和npm"></a>1.3 安装nodejs和npm</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$  sudo apt install nodejs npm</span><br></pre></td></tr></table></figure>

<h3 id="1-4-创建数据库"><a href="#1-4-创建数据库" class="headerlink" title="1.4 创建数据库"></a>1.4 创建数据库</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">$ mysql -u root -p </span><br><span class="line">Enter password: </span><br><span class="line">Welcome to the MySQL monitor.  Commands end with ; or \g.</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">mysql&gt; CREATE DATABASE IF NOT EXISTS RAP2_DELOS_APP DEFAULT CHARSET utf8 COLLATE utf8_general_ci;</span><br><span class="line">Query OK, 1 row affected, 2 warnings (0.07 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; show databases;</span><br><span class="line">+--------------------+</span><br><span class="line">| Database           |</span><br><span class="line">+--------------------+</span><br><span class="line">| RAP2_DELOS_APP     |</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<h3 id="1-5-初始化"><a href="#1-5-初始化" class="headerlink" title="1.5 初始化"></a>1.5 初始化</h3><p>1.5.1 下载rap2-delos并安装依赖软件包</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ git clone https://github.com/thx/rap2-delos.git</span><br><span class="line">...</span><br><span class="line">$ cd rap2-delos</span><br><span class="line">$ npm install</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>1.5.2 修改项目配置<br>根据需要修改<code>src/config/config.&#123;ENV&#125;.ts</code>中对应的数据库配置信息。</p>
<p>1.5.3 安装typescript</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo npm install -g typescript</span><br><span class="line">npm run build</span><br></pre></td></tr></table></figure>

<p>1.5.4 初始化数据库</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">$ npm run create-db</span><br><span class="line"></span><br><span class="line">&gt; rap2-delos@2.9.0 create-db /home/ubuntu/mysites/rap/rap2-delos</span><br><span class="line">&gt; cross-env NODE_ENV=development node dist/scripts/initSchema</span><br><span class="line"></span><br><span class="line">----------------------------------------</span><br><span class="line">DATABASE √</span><br><span class="line">    HOST     localhost</span><br><span class="line">    PORT     3306</span><br><span class="line">    DATABASE RAP2_DELOS_APP</span><br><span class="line">----------------------------------------</span><br><span class="line">成功初始化 DB Schema</span><br></pre></td></tr></table></figure>

<h3 id="1-6-启动后台服务"><a href="#1-6-启动后台服务" class="headerlink" title="1.6 启动后台服务"></a>1.6 启动后台服务</h3><p>1.6.1 开发模式下启动</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">$ npm run dev</span><br><span class="line">&gt; rap2-delos@2.9.0 dev /home/ubuntu/mysites/rap/rap2-delos</span><br><span class="line">&gt; cross-env NODE_ENV=development nodemon --watch scripts --watch dist dist/scripts/dev.js</span><br><span class="line"></span><br><span class="line">[nodemon] 2.0.21</span><br><span class="line">[nodemon] to restart at any time, enter `rs`</span><br><span class="line">[nodemon] watching path(s): scripts dist/**/*</span><br><span class="line">[nodemon] watching extensions: js,mjs,json</span><br><span class="line">[nodemon] starting `node dist/scripts/dev.js`</span><br><span class="line">Starting task: locker check</span><br><span class="line">----------------------------------------</span><br><span class="line">rap2-delos is running as http://localhost:8080</span><br><span class="line">----------------------------------------</span><br><span class="line">DATABASE √</span><br><span class="line">    HOST     localhost</span><br><span class="line">    PORT     3306</span><br><span class="line">    DATABASE RAP2_DELOS_APP</span><br><span class="line">----------------------------------------</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>1.6.2 生产模式下启动</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ npm run build</span><br><span class="line">$ npm start</span><br></pre></td></tr></table></figure>

<h2 id="2-前端部署"><a href="#2-前端部署" class="headerlink" title="2. 前端部署"></a>2. 前端部署</h2><h3 id="2-1-下载前端代码库"><a href="#2-1-下载前端代码库" class="headerlink" title="2.1 下载前端代码库"></a>2.1 下载前端代码库</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ git clone https://github.com/thx/rap2-dolores.git</span><br><span class="line">...</span><br><span class="line">$ cd rap2-delores</span><br></pre></td></tr></table></figure>

<h3 id="2-2-安装依赖"><a href="#2-2-安装依赖" class="headerlink" title="2.2 安装依赖"></a>2.2 安装依赖</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ npm install</span><br></pre></td></tr></table></figure>

<h3 id="2-3-配置后端api地址并生成静态站点"><a href="#2-3-配置后端api地址并生成静态站点" class="headerlink" title="2.3 配置后端api地址并生成静态站点"></a>2.3 配置后端api地址并生成静态站点</h3><p>配置文件路径：/src/config/config.prod.js</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">module.exports = &#123;</span><br><span class="line">  serve: &#x27;http://127.0.0.1:8080&#x27;,</span><br><span class="line">  keys: [&#x27;some secret hurr&#x27;],</span><br><span class="line">  session: &#123;</span><br><span class="line">    key: &#x27;koa:sess&#x27;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>更改<code>serve</code>字段，改成我们的后端访问地址，访问地址直接使用ip，不要使用127.0.0.1。 注意加 http://</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ npm run build</span><br></pre></td></tr></table></figure>

<h4 id="“0308010c-digital-envelope-routines-unsupported”错误"><a href="#“0308010c-digital-envelope-routines-unsupported”错误" class="headerlink" title="“0308010c:digital envelope routines::unsupported”错误"></a>“0308010c:digital envelope routines::unsupported”错误</h4><p>参考<a target="_blank" rel="noopener" href="https://www.freecodecamp.org/chinese/news/error-error-0308010c-digital-envelope-routines-unsupported-node-error-solved/">如何解决 “0308010c:digital envelope routines::unsupported” 的错误</a>，修改rap2-dolores下package.json中的<code>react-scripts start</code>命令，添加<code>--openssl-legacy-provider</code>选项。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">&quot;scripts&quot;: &#123;</span><br><span class="line">    &quot;build-css&quot;: &quot;node ./node_modules/sass/sass src/:src/ --quiet&quot;,</span><br><span class="line">    &quot;watch-css&quot;: &quot;npm run build-css &amp;&amp; node ./node_modules/sass/sass src/:src/ --watch&quot;,</span><br><span class="line">    &quot;start-js&quot;: &quot;react-scripts start --openssl-legacy-provider&quot;,</span><br><span class="line">    &quot;start&quot;: &quot;npm-run-all -p watch-css start-js --max-old-space-size=4096&quot;,</span><br><span class="line">    &quot;build&quot;: &quot;npm run lint &amp;&amp; npm run build-css &amp;&amp; react-scripts --openssl-legacy-provider build&quot;,</span><br><span class="line">    &quot;test-backup&quot;: &quot;npm run lint &amp;&amp; react-scripts test --env=jsdom&quot;,</span><br><span class="line">    &quot;test&quot;: &quot;npm run lint&quot;,</span><br><span class="line">    &quot;eject&quot;: &quot;react-scripts eject&quot;,</span><br><span class="line">    &quot;lint&quot;: &quot;tslint --project ./ -c tslint.json --fix&quot;,</span><br><span class="line">    &quot;build-docker&quot;: &quot;docker build --rm -f \&quot;Dockerfile\&quot; -t rapteam/rap2-dolores:latest .&quot;</span><br><span class="line">  &#125;,</span><br><span class="line">...</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="2-4-部署-build到服务器"><a href="#2-4-部署-build到服务器" class="headerlink" title="2.4 部署/build到服务器"></a>2.4 部署<code>/build</code>到服务器</h3><h4 id="2-4-1-ngnix配置文件"><a href="#2-4-1-ngnix配置文件" class="headerlink" title="2.4.1 ngnix配置文件"></a>2.4.1 ngnix配置文件</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">#</span><br><span class="line">server &#123;</span><br><span class="line">        listen 80;</span><br><span class="line">        listen [::]:80;</span><br><span class="line"></span><br><span class="line">        server_name rap2.example.com;</span><br><span class="line"></span><br><span class="line">        root $&#123;PATH_TO_rap2-dolores&#125;;</span><br><span class="line">        index index.html index.php;</span><br><span class="line"></span><br><span class="line">        location / &#123;</span><br><span class="line">                try_files $uri $uri/ /index.html;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="404-not-found"><a href="#404-not-found" class="headerlink" title="404 not found"></a>404 not found</h4><p>参考<a target="_blank" rel="noopener" href="https://blog.csdn.net/waterdemo/article/details/81354973">这里</a>，只需要确保nginx配置文件下的localtion路径为<code>try_files $uri $uri/ /index.html;</code>即可。</p>
<p>如果使用了下边的配置，就会出现404错误</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">location / &#123;</span><br><span class="line">        try_files $uri $uri/ =404;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>




      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN,en,default">
    <link itemprop="mainEntityOfPage" href="https://moakap.github.io/2023/02/24/superficial/Install_Flarum/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/snail-filled.png">
      <meta itemprop="name" content="moakap">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Moakap's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/02/24/superficial/Install_Flarum/" class="post-title-link" itemprop="url">安装Flarum</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2023-02-24 10:19:55" itemprop="dateCreated datePublished" datetime="2023-02-24T10:19:55+00:00">2023-02-24</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%9C%BB%E8%9C%93%E7%82%B9%E6%B0%B4/" itemprop="url" rel="index"><span itemprop="name">蜻蜓点水</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%9C%BB%E8%9C%93%E7%82%B9%E6%B0%B4/Flarum/" itemprop="url" rel="index"><span itemprop="name">Flarum</span></a>
                </span>
            </span>

          
            <span id="/2023/02/24/superficial/Install_Flarum/" class="post-meta-item leancloud_visitors" data-flag-title="安装Flarum" title="阅读次数">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/2023/02/24/superficial/Install_Flarum/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2023/02/24/superficial/Install_Flarum/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="1-安装Composer"><a href="#1-安装Composer" class="headerlink" title="1. 安装Composer"></a>1. 安装Composer</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">php -r &quot;copy(&#x27;https://getcomposer.org/installer&#x27;, &#x27;composer-setup.php&#x27;);&quot;</span><br><span class="line">php -r &quot;if (hash_file(&#x27;sha384&#x27;, &#x27;composer-setup.php&#x27;) === &#x27;55ce33d7678c5a611085589f1f3ddf8b3c52d662cd01d4ba75c0ee0459970c2200a51f492d557530c71c15d8dba01eae&#x27;) &#123; echo &#x27;Installer verified&#x27;; &#125; else &#123; echo &#x27;Installer corrupt&#x27;; unlink(&#x27;composer-setup.php&#x27;); &#125; echo PHP_EOL;&quot;</span><br><span class="line">php composer-setup.php</span><br><span class="line">php -r &quot;unlink(&#x27;composer-setup.php&#x27;);&quot;</span><br></pre></td></tr></table></figure>

<h2 id="2-安装Flarum"><a href="#2-安装Flarum" class="headerlink" title="2. 安装Flarum"></a>2. 安装Flarum</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">composer create-project flarum/flarum . </span><br></pre></td></tr></table></figure>

<h2 id="3-设置nginx和URL重写"><a href="#3-设置nginx和URL重写" class="headerlink" title="3. 设置nginx和URL重写"></a>3. 设置nginx和URL重写</h2><p>在nginx站点配置文件中添加root和flarum 配置文件。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root /&lt;Flarum路径&gt;/public</span><br><span class="line">include /&lt;Flarum 路径&gt;/.nginx.conf;</span><br></pre></td></tr></table></figure>

<h2 id="4-安装Flarum"><a href="#4-安装Flarum" class="headerlink" title="4. 安装Flarum"></a>4. 安装Flarum</h2>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN,en,default">
    <link itemprop="mainEntityOfPage" href="https://moakap.github.io/2022/06/01/ML/Linear_regression_in_Python_Sklearn/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/snail-filled.png">
      <meta itemprop="name" content="moakap">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Moakap's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/06/01/ML/Linear_regression_in_Python_Sklearn/" class="post-title-link" itemprop="url">机器学习之Python Sklearn——线性回归</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-06-01 15:15:51" itemprop="dateCreated datePublished" datetime="2022-06-01T15:15:51+00:00">2022-06-01</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%9C%BB%E8%9C%93%E7%82%B9%E6%B0%B4/" itemprop="url" rel="index"><span itemprop="name">蜻蜓点水</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%9C%BB%E8%9C%93%E7%82%B9%E6%B0%B4/ML/" itemprop="url" rel="index"><span itemprop="name">ML</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%9C%BB%E8%9C%93%E7%82%B9%E6%B0%B4/ML/Sklearn/" itemprop="url" rel="index"><span itemprop="name">Sklearn</span></a>
                </span>
            </span>

          
            <span id="/2022/06/01/ML/Linear_regression_in_Python_Sklearn/" class="post-meta-item leancloud_visitors" data-flag-title="机器学习之Python Sklearn——线性回归" title="阅读次数">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/2022/06/01/ML/Linear_regression_in_Python_Sklearn/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2022/06/01/ML/Linear_regression_in_Python_Sklearn/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p><img src="https://github.com/moakap/moakap.github.io/assets/6308127/8778ba9b-b307-483e-a819-bbdcb3caa0e6" alt="image"></p>
<p>这里重点学习一下回归算法</p>
<h2 id="机器学习基础"><a href="#机器学习基础" class="headerlink" title="机器学习基础"></a>机器学习基础</h2><h3 id="机器学习-vs-传统编程"><a href="#机器学习-vs-传统编程" class="headerlink" title="机器学习 vs. 传统编程"></a>机器学习 vs. 传统编程</h3><p><img src="https://user-images.githubusercontent.com/6308127/158024257-4a667037-e685-4875-98a0-71fbf52549c5.png" alt="image"></p>
<h3 id="三种类别"><a href="#三种类别" class="headerlink" title="三种类别"></a>三种类别</h3><p>根据使用场景不同，有可以划分为三大类</p>
<h4 id="监督学习"><a href="#监督学习" class="headerlink" title="监督学习"></a>监督学习</h4><p>监督学习是根据已知的方法和规律，对新样本进行分类和预测。<br>监督学习就好比学生在学校学习各种知识和理论的过程。整个过程是在老师的监督下完成，所学知识的应用体现在平时的测试中，并且可以通过对比“标准”答案来不断改进和巩固学习成果，在下一次的测试中取得更好的成绩（预测效果）。根据目的不同，可以有分类和回归（预测）两种：</p>
<ul>
<li>分类 —— 根据事物特征将其划分到已知的类别。<ul>
<li>根据事物的特征，将新遇到的事物（新样本）归类到已知的某个类别。</li>
</ul>
</li>
<li>回归（预测）—— 根据事物的特征和预测将来的发展趋势。<ul>
<li>根据事物的特征和发展规律，预测将来的发展趋势。</li>
</ul>
</li>
</ul>
<h4 id="非监督学习"><a href="#非监督学习" class="headerlink" title="非监督学习"></a>非监督学习</h4><p>非监督学习与监督学习正好相反，在过程中并不清楚有哪些特征标签，而是通过对样本的观察、分析和总结，去发现其中的特征，从看似杂乱无章的数据中发现共性。然后对新样本进行归类。</p>
<blockquote>
<p>归类/聚类（clustering）—— 对大量看似无特征的样本进行分类。</p>
</blockquote>
<p>经常会说非监督学习是归类或聚类（clustering）。与分类不同，聚类在划分之前并不知道有哪些类别，以及类别的特征，而是通过对样本的各种特征进行分析，将相似的样本划分为一组，进行“物以类聚”的划分。是一个从无到有的发现过程。</p>
<h4 id="半监督学习"><a href="#半监督学习" class="headerlink" title="半监督学习"></a>半监督学习</h4><p>介于监督和非监督学习之间。是基于监督学习获得理论和知识，对非监督学习的样本（无特征标签）进行分类。可以理解为我们走出学校以后根据在课堂上学到的知识和理论，对生活中遇到的事物进行分类和预测。</p>
<h2 id="Python-sklearn-scikit-learn"><a href="#Python-sklearn-scikit-learn" class="headerlink" title="Python sklearn (scikit-learn)"></a>Python sklearn (scikit-learn)</h2><p>Scikit-learn是一个用于Python的免费开源机器学习库。</p>
<h3 id="机器学习三大步骤"><a href="#机器学习三大步骤" class="headerlink" title="机器学习三大步骤"></a>机器学习三大步骤</h3><p>机器学习的本质就是让机器使用特定的算法对输入数据进行类似人的智能学习（找规律），根据同样的模型对新样本进行进行预测。具体到python中的sklearn，是通过一下三大步骤实现的。</p>
<p><img src="https://github.com/moakap/moakap.github.io/assets/6308127/9f65e409-5b3e-4fb6-8562-d265e1f8529b" alt="image"></p>
<ol>
<li>准备数据——对输入数据进行预处理</li>
<li>选择、训练和测试模型——使用处理后的样本数据，针对特定模型进行拟合、训练<ol>
<li>模型的选择，可以根据要解决的问题和使用场景，scikit-learn提供了一张图（<a target="_blank" rel="noopener" href="https://scikit-learn.org/stable/tutorial/machine_learning_map/index.html">选择正确的估计器</a>）来详细描述模型选择的流程，最终指向机器学习的集中主要使用场景，<strong>回归、分类</strong>和<strong>聚类</strong>，以及scikit-learn提供的<strong>数据降维</strong>方法。</li>
</ol>
</li>
</ol>
<p><img src="https://user-images.githubusercontent.com/6308127/158024353-55d53328-ecd2-4fae-a888-5eb1ed0ac771.png" alt="image"></p>
<ol start="3">
<li>使用模型预测——使用训练后的模型对新样本进行预测，并根据预测结果过进一步优化</li>
</ol>
<h3 id="scikit-learn-sklearn-实现"><a href="#scikit-learn-sklearn-实现" class="headerlink" title="scikit-learn (sklearn) 实现"></a>scikit-learn (sklearn) 实现</h3><p>sklearn中内置了常用的机器学习算法和模型，以及基本的预处理方法。分别由<strong>预测（估计）器（estimator）</strong>和<strong>预处理器（preprocessing）</strong>实现，并且它们继承自同一个基础预测器。</p>
<p><img src="https://github.com/moakap/moakap.github.io/assets/6308127/be0eb8c9-5ad5-4833-9f25-bacc8ac7d8be" alt="image"></p>
<h4 id="转换器和预处理器"><a href="#转换器和预处理器" class="headerlink" title="转换器和预处理器"></a>转换器和预处理器</h4><p>预处理器和转换器主要负责对原始数据的预处理和转换，从而消除不同数据之间的绝对差异。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sklearn.preprocessing <span class="keyword">import</span> StandardScaler</span><br><span class="line"></span><br><span class="line"><span class="comment"># ...</span></span><br><span class="line"><span class="comment"># X = [...]</span></span><br><span class="line"></span><br><span class="line">StandardScaler().fit().transform(X)</span><br></pre></td></tr></table></figure>

<h4 id="预测器"><a href="#预测器" class="headerlink" title="预测器"></a>预测器</h4><p>sklearn中提供的数十种内置机器学习算法和模型，都通过估算器提供。可以通过引入相应的估算器来使用对应的模型。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sklearn.ensemble <span class="keyword">import</span> RandomForestClassifier</span><br><span class="line"></span><br><span class="line"><span class="comment"># 初始化估算器</span></span><br><span class="line">clf = RandomForestClassifier(random_state=<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用训练数据进行模型拟合</span></span><br><span class="line">clf.fit(X, y)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 预测</span></span><br><span class="line">clf.predict(...) <span class="comment"># </span></span><br></pre></td></tr></table></figure>

<h4 id="管道"><a href="#管道" class="headerlink" title="管道"></a>管道</h4><p>管道用来将转换器和预测器组合成一个同一的对象，表示一个完整的数据流处理过程（管道）。然后使用管道的fit和predict来进行训练和预测。同时，使用管道还可以防止数据泄露。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sklearn.preprocessing <span class="keyword">import</span> StandardScaler <span class="comment"># 预处理器</span></span><br><span class="line"><span class="keyword">from</span> sklearn.linear_model <span class="keyword">import</span> LogisticRegression <span class="comment"># 预测器</span></span><br><span class="line"><span class="keyword">from</span> sklearn.pipeline <span class="keyword">import</span> make_pipeline <span class="comment"># 管道</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建管道</span></span><br><span class="line">pipe = make_pipeline(</span><br><span class="line">    StandardScaler(),</span><br><span class="line">    LogisticRegression(random_state=<span class="number">0</span>)</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">#准备数据...</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 像使用预测器一样使用管道</span></span><br><span class="line"><span class="comment"># 1) 训练整个pipeline</span></span><br><span class="line">pipe.fit(X_train, y_train)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2) 使用管道预测</span></span><br><span class="line">pipe.predict(X_test)</span><br><span class="line"></span><br><span class="line"><span class="comment"># ...</span></span><br></pre></td></tr></table></figure>
<h3 id="模型评估"><a href="#模型评估" class="headerlink" title="模型评估"></a>模型评估</h3><p>针对不同类型的算法和模型，对应评估指标也不相同。</p>
<h4 id="回归算法指标"><a href="#回归算法指标" class="headerlink" title="回归算法指标"></a>回归算法指标</h4><p>回归算法的核心思想是评估预测值和观察值之间的误差。从最原始的残差（residual）到基于残差的各种变形，以便后续的数学运算和处理。</p>
<ul>
<li>Mean Absolute Error 平均绝对误差：对残差做绝对值处理，避免残差正负导致的相互抵消。</li>
<li>Mean Squared Error 均方误差：为了便于求导，对平均绝对误差进行平方。</li>
<li>Root Mean Squared Error 均方根误差：如果目标变量的量纲保持一致，可以对均方误差进行开放。</li>
<li>Coefficient of determination 决定系数：进一步去除对量纲的依赖。</li>
</ul>
<h4 id="分类算法指标"><a href="#分类算法指标" class="headerlink" title="分类算法指标"></a>分类算法指标</h4><p>相比较回归算法的各种残差指标，分类算法更多的则是关注分类的精度，即预测正确的样本数量占总预测样本的比例。然后，预计不同的场景，从不同角度来看精度对结果的影响。</p>
<ul>
<li>Accuracy 精度：每一个分类中预测正确的样本数占总样本的比例。</li>
<li>混淆矩阵 Confusion Matrix</li>
<li>准确率（查准率） Precision</li>
<li>召回率（查全率）Recall</li>
<li>Fβ Score</li>
<li>AUC Area Under Curve</li>
<li>KS Kolmogorov-Smirnov</li>
</ul>
<p>关于各个指标的详细说明，可以参考<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/36305931">知乎——机器学习评估指标</a>。</p>
<h3 id="参数搜索"><a href="#参数搜索" class="headerlink" title="参数搜索"></a>参数搜索</h3><p>所有预测器都有可以调整的参数，也叫<strong>超参数</strong>。其特指不能通过学习得到的参数。在使用各种不同模型时，需要将超参数作为参数传递给预测器。<br>sklearn中提供了在参数集中搜索最佳超参数的方法，其基于最佳<a target="_blank" rel="noopener" href="http://scikit-learn.org.cn/view/6.html"><strong>交叉验证</strong></a><strong>（CV, Cross-Validation）分数</strong>获取对应的超参数。sklearn中最简单的方法是调用<a target="_blank" rel="noopener" href="https://scikit-learn.org.cn/view/663.html">cross_val_score</a>函数。</p>
<blockquote>
<p>估算器中的任意参数都可以通过参数搜索来获得最佳参数。</p>
</blockquote>
<p>参数搜索的基本要素</p>
<ul>
<li>参数搜索方法</li>
<li>评估方法</li>
</ul>
<p>sklearn中两种抽样搜索最佳参数的方法：</p>
<h4 id="GridSearchCV-网格搜索方法"><a href="#GridSearchCV-网格搜索方法" class="headerlink" title="GridSearchCV 网格搜索方法"></a>GridSearchCV 网格搜索方法</h4><p>计算参数集中所有参数的组合。GridSearchCV通过使用param_grid参数来指定参数候选值。<br>例如下边的例子指定搜索两个参数候选值。通过GridSearchCV的fitting接口拟合后，会对所有候选参数进行评估，保留最优参数组合。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 选择模型</span></span><br><span class="line">clf = ...</span><br><span class="line"></span><br><span class="line"><span class="comment"># 指定网格搜索的参数</span></span><br><span class="line">param_grid = [</span><br><span class="line">  &#123;<span class="string">&#x27;C&#x27;</span>: [<span class="number">1</span>, <span class="number">10</span>, <span class="number">100</span>, <span class="number">1000</span>], <span class="string">&#x27;kernel&#x27;</span>: [<span class="string">&#x27;linear&#x27;</span>]&#125;,</span><br><span class="line">  &#123;<span class="string">&#x27;C&#x27;</span>: [<span class="number">1</span>, <span class="number">10</span>, <span class="number">100</span>, <span class="number">1000</span>], <span class="string">&#x27;gamma&#x27;</span>: [<span class="number">0.001</span>, <span class="number">0.0001</span>], <span class="string">&#x27;kernel&#x27;</span>: [<span class="string">&#x27;rbf&#x27;</span>]&#125;,</span><br><span class="line"> ] </span><br><span class="line"></span><br><span class="line"><span class="comment"># 运行网格搜索</span></span><br><span class="line">grid_search = GridSearchCV(clf, param_grid=param_grid)</span><br><span class="line"></span><br><span class="line"><span class="comment"># ...</span></span><br><span class="line">grid_search.fit(X, y)</span><br></pre></td></tr></table></figure>
<h4 id="RandomizedSearchCV-随机搜索方法"><a href="#RandomizedSearchCV-随机搜索方法" class="headerlink" title="RandomizedSearchCV 随机搜索方法"></a>RandomizedSearchCV 随机搜索方法</h4><p>从具有制定分布的参数空间中抽样出定量的参数候选。RandomizedSearchCV会在指定范围内，使用某个特定分布抽取参数值进行评估。用字典形式来指定参数的具体抽样范围，针对每一个参数，可以指定</p>
<ul>
<li>具体的参数</li>
<li>采样分布——可以使用scipy.stats模块，其中包含了很多采样分布，如expon，gamma，uniform或者randint。</li>
<li>离散选项列表</li>
</ul>
<p>例子</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 选择模型</span></span><br><span class="line">clf = ...</span><br><span class="line"></span><br><span class="line"><span class="comment"># RandomizedSearchCV 参数设置示例</span></span><br><span class="line">param_dist = &#123;</span><br><span class="line">    <span class="string">&#x27;C&#x27;</span>: scipy.stats.expon(scale=<span class="number">100</span>),  <span class="comment"># 取值分布</span></span><br><span class="line">    <span class="string">&#x27;gamma&#x27;</span>: scipy.stats.expon(scale=<span class="number">.1</span>),</span><br><span class="line">    <span class="string">&#x27;kernel&#x27;</span>: [<span class="string">&#x27;rbf&#x27;</span>], <span class="comment"># 离散列表</span></span><br><span class="line">    <span class="string">&#x27;class_weight&#x27;</span>:[<span class="string">&#x27;balanced&#x27;</span>, <span class="literal">None</span>] <span class="comment"># 离散列表</span></span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line"><span class="comment"># 运行随机搜索</span></span><br><span class="line">n_iter_search = <span class="number">20</span></span><br><span class="line">random_search = RandomizedSearchCV(clf, param_distributions=param_dist,</span><br><span class="line">                                   n_iter=n_iter_search)</span><br><span class="line"></span><br><span class="line"><span class="comment"># ...</span></span><br><span class="line">random_search.fit(X, y)</span><br></pre></td></tr></table></figure>
<h4 id="评估方法（指标）"><a href="#评估方法（指标）" class="headerlink" title="评估方法（指标）"></a>评估方法（指标）</h4><p>参数搜索默认使用估计器的score函数来评估参数的设置。默认为</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://scikit-learn.org.cn/view/476.html">sklearn.metrics.accuracy_score</a> 用于分类</li>
<li><a target="_blank" rel="noopener" href="https://scikit-learn.org.cn/view/519.html">sklearn.metrics.r2_score</a> 应用于回归</li>
</ul>
<p>当然，sklearn还提供了其它一些<a target="_blank" rel="noopener" href="http://scikit-learn.org.cn/view/93.html#3.3.1%20%E8%AF%84%E5%88%86%E5%8F%82%E6%95%B0%EF%BC%9A%E5%AE%9A%E4%B9%89%E6%A8%A1%E5%9E%8B%E8%AF%84%E4%BC%B0%E5%87%86%E5%88%99">评估函数</a>可供不从场景使用。同时，也可以将多种评估指标结合起来使用。</p>
<h2 id="回归算法"><a href="#回归算法" class="headerlink" title="回归算法"></a>回归算法</h2><p>从sklearn模型流程可以很清楚得看到回归算法的使用场景。</p>
<p><img src="https://github.com/moakap/moakap.github.io/assets/6308127/2dabe469-f961-4042-8aa9-d0be2c69c237" alt="image"></p>
<p>使用场景</p>
<ul>
<li>样本数大于50</li>
<li>需要预测将来的某个具体数据（而不是对数据分类）</li>
</ul>
<p>然后根据样本数据数据和特征标签的特点选择对应的算法</p>
<ul>
<li>样本数大于100K时，推荐使用SGDRegressor</li>
<li>样本数小于100K时，则推荐使用Ridge, Lasso, 或者ElasticNet等；然后根据样本数据特征标签的权重，进行进一步选择。<ul>
<li>如果样本数据的特征标签同等重要，可以选择RidgeRegression或SVR;</li>
<li>如果样本数据的某些特征更重要，对结果影响更大，可以使用Lasso和ElasticNet；<h3 id="回归分析（Regression-Analysis）"><a href="#回归分析（Regression-Analysis）" class="headerlink" title="回归分析（Regression Analysis）"></a>回归分析（Regression Analysis）</h3>在搞清楚线性回归之前，我们首先要弄明白什么是<strong>回归分析</strong>。在统计学中，是指<strong>确定两种或两种以上变量间相互依赖的定量关系</strong>的一种统计分析方法。<br>按照涉及的变量多少，可以分为<strong>一元回归</strong>和<strong>多元回归</strong>；按照因变量的多少，可分为<strong>简单回归分析</strong>和<strong>多重回归分析</strong>；按照自变量和因变量之间的关系类型，可分为<strong>线性回归分析</strong>和<strong>非线性回归分析</strong>。</li>
</ul>
</li>
</ul>
<h3 id="线性回归（Liner-Regression）基础"><a href="#线性回归（Liner-Regression）基础" class="headerlink" title="线性回归（Liner Regression）基础"></a>线性回归（Liner Regression）基础</h3><p>线性回归假设目标值（因变量）是特征值（自变量）的线性组合。线性回归使用最佳的拟合直线在因变量（$Y$）和一个或多个自变量（$X$）之间建立一种关系。因变量是连续的，自变量可以是连续的也可以是离散的，回归线的性质是线性的。<br>在数学中，即为由特征值组成的多元一次方程。<br>$Y=b+w_1x_1+…+w_px_p+\epsilon$<br>如果将自变量表示为$X=(x_1,…x_p)$，系数表示为$W=(w_1, …, w_p)$，就能明白为什么它叫线性回归了。<br>$Y=b+W^TX+\epsilon$<br>其中$W$是回归线的斜率，$w_0$则表示回归线在Y轴上的截距，$\epsilon$表示误差项。<br>上边的表示中，我们默认自变量和因变量都是多元的。这里我们限制因变量的个数为一个，则可以直接表示为<br>$y=b+W^TX+\epsilon$<br>线性回归就是通过各种算法去找到这样一个多元一次方程$\hat{y}(x)=b+wX$，使其尽量接近观真实值$y$（残差$\epsilon$尽量小）。而拟合的过程，就是去不断优化和估计方程的斜率系数，所以也叫“回归系数（coefficient）”。<br>这里要注意模型<strong>偏差bias</strong>和<strong>残差（噪声）</strong>的区别。</p>
<ul>
<li>偏差$b$——指排除噪声影响下，预测结果与真实值之间的差异。其主要是由模型的拟合度不够导致的（不是随机的，并且可通过一定的特征工程进行预测）。</li>
<li>残差$\epsilon$——预测结果与真实值之间的差异。在模型完全拟合的情况下，与真实值之间的差异，因此可以理解为噪声（随机、不可预测的）。</li>
</ul>
<h4 id="预测值和真实值的距离"><a href="#预测值和真实值的距离" class="headerlink" title="预测值和真实值的距离"></a>预测值和真实值的距离</h4><p>那么，如何衡量预测的准确性，即衡量预测值$\hat{y}(x)$与真实值$y$之间的差异呢？最直观的方法就是看真实值和预测值之间的差(残差)。回归模型的目的就是使模型预测出来的值无限接近真实值（测量值）。<br>$\hat{\epsilon} = y - \hat{y}(x)$<br>但是在实际预测中，残差值有正有负，不可能直接使用残差之和最小的方式来衡量一种方法的好坏。<br>因此，整个回归问题的本质，就是使用均方误差，求使$D$最小时的$W$和$d$。<br>$D=E(y-\hat{y}(x))^2$</p>
<h5 id="1-残差平方和SSE"><a href="#1-残差平方和SSE" class="headerlink" title="1. 残差平方和SSE"></a>1. 残差平方和SSE</h5><p>由于残差本身有正有负，故可以使用平方和来避免正负抵消问题。<br>$dist(P_i, P_j) = \sum_{k=1}^n(P_ik-P_jk)^2$<br>问题：</p>
<ol>
<li><p>使用平方后会放大（差&gt;1）部分的误差，同时缩小（-1&lt;差&lt;1）部分的误差；</p>
</li>
<li><p>当不同维度的度量差异很大时无法处理；</p>
<h5 id="2-欧氏距离"><a href="#2-欧氏距离" class="headerlink" title="2. 欧氏距离"></a>2. 欧氏距离</h5><p>为了解决误差平方和的问题，我们可以使用欧式距离。<br>$dist(P_i, P_j) = \sqrt{\sum_{k=1}^n(P_ik-P_jk)^2}$<br>问题：</p>
</li>
<li><p>求解麻烦；</p>
</li>
<li><p>不同问题的度量差异很大时无法处理；</p>
<h5 id="3-曼哈顿距离"><a href="#3-曼哈顿距离" class="headerlink" title="3. 曼哈顿距离"></a>3. 曼哈顿距离</h5><p>曼哈顿距离直接使用绝对值来消除根号开方的求解麻烦问题。<br>$dist(P_i, P_j) = \sum_{k=1}^n\vert P_ik-P_jk\vert$<br>问题：</p>
</li>
<li><p>不是连续函数，<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/%E6%B1%82%E5%AF%BC/1063861">求导</a>很麻烦，计算不方便，只能计算垂直、水平距离</p>
</li>
</ol>
<p>适合场景：数据稀疏（自带归一化处理）</p>
<h5 id="4-马氏距离-Mahalanobis-Distance"><a href="#4-马氏距离-Mahalanobis-Distance" class="headerlink" title="4. 马氏距离(Mahalanobis Distance)"></a>4. 马氏距离(Mahalanobis Distance)</h5><p>马氏距离是对欧式距离的另外一种修正，修正了欧氏距离中各个维度尺度不一致且相关的问题。<br>$dist(P_i, P_j) = \sqrt{(P_ik-P_jk)^T\Sigma^{-1}(P_ik-P_jk)}$<br>马氏距离已经不像前边的几种那么好理解，具体推导过程可以参考<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/46626607">马氏距离</a>。总之，其较好的解决了不同维度尺度不一致且相关的问题。</p>
<h5 id="5-其它"><a href="#5-其它" class="headerlink" title="5. 其它"></a>5. 其它</h5><p>其它还有一些距离如汉明距离(Hamming Distance)、编辑距离(Levenshtein Distance)等，这里不做一一说明。</p>
<h4 id="普通最小二乘法-Ordinary-Least-Square-OLS"><a href="#普通最小二乘法-Ordinary-Least-Square-OLS" class="headerlink" title="普通最小二乘法(Ordinary Least Square, OLS)"></a>普通最小二乘法(Ordinary Least Square, OLS)</h4><p>最小二乘法直接使用残差的平方和作为衡量标准，通过拟合$W$使残差$\epsilon$的平方和最小。数学上表示为下边的形式：<br>$min{\Vert Xw-y\Vert _2^2}$</p>
<p><img src="https://github.com/moakap/moakap.github.io/assets/6308127/d00ad045-6ed6-4e03-aa25-71789c15485b" alt="image"></p>
<p>在sklearn的线性回归模型LinearRegression中，使用$fit()$函数拟合模型，并在模型的coef_中存储拟合后的相关系数$w$。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">from</span> sklearn <span class="keyword">import</span> datasets, linear_model</span><br><span class="line"></span><br><span class="line"><span class="comment"># ...准备数据，选择特征列，拆分训练、测试数据集..</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Create linear regression object</span></span><br><span class="line">regr = linear_model.LinearRegression()</span><br><span class="line"></span><br><span class="line"><span class="comment"># Train the model using the training sets</span></span><br><span class="line">regr.fit(diabetes_X_train, diabetes_y_train)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Make predictions using the testing set</span></span><br><span class="line">diabetes_y_pred = regr.predict(diabetes_X_test)</span><br><span class="line"></span><br><span class="line"><span class="comment"># The coefficients</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Coefficients: \n&quot;</span>, regr.coef_)</span><br><span class="line"><span class="comment"># The mean squared error</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Mean squared error: %.2f&quot;</span> % mean_squared_error(diabetes_y_test, diabetes_y_pred))</span><br><span class="line"><span class="comment"># The coefficient of determination: 1 is perfect prediction</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Coefficient of determination: %.2f&quot;</span> % r2_score(diabetes_y_test, diabetes_y_pred))</span><br></pre></td></tr></table></figure>
<h5 id="非负最小方差"><a href="#非负最小方差" class="headerlink" title="非负最小方差"></a>非负最小方差</h5><p>在最小二乘法法返回的系数中，默认是不会对系数的正负进行限制的。但是在实际问题中，很多时候我们需要所有的相关系数非负，例如频次、商品价格等。这时候可以直接设置LinearRegression的positive参数为True来限制相关系数的正负。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sklearn.linear_model <span class="keyword">import</span> LinearRegression</span><br><span class="line"></span><br><span class="line">reg_nnls = LinearRegression(positive=<span class="literal">True</span>)</span><br><span class="line">y_pred_nnls = reg_nnls.fit(X_train, y_train).predict(X_test)</span><br><span class="line">r2_score_nnls = r2_score(y_test, y_pred_nnls)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;NNLS R2 score&quot;</span>, r2_score_nnls)</span><br></pre></td></tr></table></figure>

<blockquote>
<p>问题<br>普通最小二乘的系数估计依赖于特征的独立性。当特征相关且设计矩阵的列之间具有近似线性相关性时， 设计矩阵趋于奇异矩阵，最小二乘估计对观测目标的随机误差高度敏感，可能产生很大的方差。例如，在没有实验设计的情况下收集数据时，就可能会出现这种多重共线性的情况。</p>
</blockquote>
<h4 id="过拟合-Overfitting-和欠拟合-Underfitting"><a href="#过拟合-Overfitting-和欠拟合-Underfitting" class="headerlink" title="过拟合(Overfitting)和欠拟合(Underfitting)"></a>过拟合(Overfitting)和欠拟合(Underfitting)</h4><p>过拟合和欠拟合是使用实际数据进行分析时可能会遇到的两种基本问题。</p>
<p><img src="https://github.com/moakap/moakap.github.io/assets/6308127/4243d0aa-dd7a-4149-bf64-0e09a359c0ed" alt="image"></p>
<ul>
<li><strong>欠拟合</strong>——指模型在训练集中的表现就很差了，经验误差很大。</li>
</ul>
<p>欠拟合出现的原因是模型复杂度太低，比如自变量太少等。针对欠拟合，要做的就是增大模型复杂度，增加自变量，或者改变模型（线性到非线性）等。</p>
<ul>
<li><strong>过拟合</strong>——指模型在训练集中表现良好，而测试集中表现很差，即泛化误差大于了经验误差，拟合过度，模型泛化能力降低，只能够适用于训练集，通用性不强。</li>
</ul>
<p>过拟合的原因是模型复杂度太高，或者训练数据集太少，比如自变量过多等。针对过拟合，除了增加训练集数据外，正则化就是常用的一种处理方法。</p>
<h5 id="正则化"><a href="#正则化" class="headerlink" title="正则化"></a>正则化</h5><ul>
<li><strong>正则化(Regularization)</strong> 是机器学习中对原始损失函数引入额外信息，以便防止过拟合和提高模型泛化性能的一类方法的统称。也就是目标函数变成了<strong>原始损失函数+额外项</strong>，常用的额外项一般有两种，英文称作ℓ1−𝑛𝑜𝑟𝑚ℓ1−norm和ℓ2−𝑛𝑜𝑟𝑚ℓ2−norm，中文称作<strong>L1正则化</strong>和<strong>L2正则化</strong>，或者L1范数和L2范数（实际是L2范数的平方）。</li>
<li>L1正则化和L2正则化可以看做是<strong>损失函数的惩罚项</strong>。所谓<strong>惩罚</strong>是指对损失函数中的<strong>某些参数做一些限制</strong>。对于线性回归模型，<strong>使用L1正则化的模型叫做Lasso回归，使用L2正则化的模型叫做Ridge回归（岭回归）</strong>。</li>
</ul>
<p>关于正则化的更多详细理解可以参考<a target="_blank" rel="noopener" href="https://www.cnblogs.com/zingp/p/10375691.html#_label0">深入理解L1、L2正则化</a>，以及<a target="_blank" rel="noopener" href="https://blog.csdn.net/jinping_shi/article/details/52433975">机器学习中正则化项L1和L2的直观理解</a>。</p>
<h4 id="岭-Ridge-回归（L2正则化）"><a href="#岭-Ridge-回归（L2正则化）" class="headerlink" title="岭(Ridge)回归（L2正则化）"></a>岭(Ridge)回归（L2正则化）</h4><p>针对最小二乘法存在的一下问题，岭回归则计算一个<strong>带惩罚项的残差平方和</strong>。<br>$min{\Vert Xw-y\Vert _2^2}+\alpha\Vert w \Vert _2^2$<br>其中$\Vert w \Vert _2^2$为回归系数向量的L2范数（所有参数的平方和）。使用复杂度参数$\alpha \ge0$来控制收缩程度：值越大，收缩程度越大，对应的回归系数对共线性的容忍程度也就越大。至于为什么L2正则化能防止过拟合，可以参考<a target="_blank" rel="noopener" href="https://www.cnblogs.com/zingp/p/10375691.html#_label0">深入理解L1、L2正则化</a>。</p>
<p><img src="https://github.com/moakap/moakap.github.io/assets/6308127/8928205c-4bab-423e-b754-27eb7e510c10" alt="image"></p>
<p>在sklearn中，可以通过指定alpha参数来设定$\alpha$。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sklearn <span class="keyword">import</span> linear_model</span><br><span class="line"></span><br><span class="line"><span class="comment"># 指定alpha的岭回归</span></span><br><span class="line">reg = linear_model.Ridge(alpha=<span class="number">.5</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 拟合</span></span><br><span class="line">reg.fit([[<span class="number">0</span>, <span class="number">0</span>], [<span class="number">0</span>, <span class="number">0</span>], [<span class="number">1</span>, <span class="number">1</span>]], [<span class="number">0</span>, <span class="number">.1</span>, <span class="number">1</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment"># ...</span></span><br></pre></td></tr></table></figure>
<h4 id="Lasso回归（L1正则化）"><a href="#Lasso回归（L1正则化）" class="headerlink" title="Lasso回归（L1正则化）"></a>Lasso回归（L1正则化）</h4><p>Lasso回归与Ridge岭回归类似，都是在普通最小二乘法基础上的正则化处理。目标函数在数学上表示为<br>$min{\frac1{2n_{sample}}\Vert Xw-y\Vert _2^2}+\alpha\Vert w \Vert_1$<br>其中$\Vert w \Vert _1$为回归系数向量的L1范数（所有参数绝对值之和）。</p>
<h5 id="特征选取与压缩感知"><a href="#特征选取与压缩感知" class="headerlink" title="特征选取与压缩感知"></a>特征选取与压缩感知</h5><p>特征选取就是对样本进行稀疏表示的过程。而Lasso正好就是估计稀疏系数的线性模型，因为它倾向于给出非零系数较少的解，从而有效地减少了给定解所依赖的特征数。至于为什么L1正则化能减少给定解所依赖的特征数，可以参考<a target="_blank" rel="noopener" href="https://www.cnblogs.com/zingp/p/10375691.html#_label0">深入理解L1、L2正则化</a>。<br>所以说，Lasso 及其变体是压缩感知领域的基础。关于稀疏表示，参考 <a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/151901026">机器学习基础——稀疏表示</a>。</p>
<blockquote>
<p>稀疏表示<br>任意一个信号都可以在一个过完备字典上稀疏线性表出。这样，一个信号被分解为有限个信号的线形组合的形式我们称之为稀疏表示。表达为公式为：<br>y = D_α_ <em>s.t</em>.||α||0 &lt; σ</p>
</blockquote>
<h4 id="Elastic-Net弹性网络回归（L1-L2正则化）"><a href="#Elastic-Net弹性网络回归（L1-L2正则化）" class="headerlink" title="Elastic-Net弹性网络回归（L1+L2正则化）"></a>Elastic-Net弹性网络回归（L1+L2正则化）</h4><p>弹性网络回归是一个综合了Ridge回归和Lasso回归两种惩罚因数的单一模型：一个因素与L1范数成比例，另外一个因数与L2范数成比例。其目标函数表示为<br>$min{\frac1{2n_{sample}}\Vert Xw-y\Vert _2^2}+\alpha\beta\Vert w \Vert_1+\frac{\alpha(1-\beta)}{2} \Vert w \Vert_2^2$<br>从上边的公式可以看出，ElasticNet使用时需要提供$\alpha$和$\beta$两个参数。其中$\beta$的参数名称为l1_ratio。</p>
<blockquote>
<p>当多个特征存在相关时，弹性网是很有用的。Lasso很可能随机挑选其中之一，而弹性网则可能兼而有之。</p>
</blockquote>
<h4 id="预估正则化参数——贝叶斯回归"><a href="#预估正则化参数——贝叶斯回归" class="headerlink" title="预估正则化参数——贝叶斯回归"></a>预估正则化参数——贝叶斯回归</h4><p>主要用于预估正则化参数：正则化参数不是应意义上的设置，而是根据数据进行调整。</p>
<h5 id="贝叶斯岭回归"><a href="#贝叶斯岭回归" class="headerlink" title="贝叶斯岭回归"></a>贝叶斯岭回归</h5><h5 id="自动关联判定-ARD"><a href="#自动关联判定-ARD" class="headerlink" title="自动关联判定-ARD"></a>自动关联判定-ARD</h5><h4 id="高维数据的线性回归"><a href="#高维数据的线性回归" class="headerlink" title="高维数据的线性回归"></a>高维数据的线性回归</h4><h5 id="特征选择"><a href="#特征选择" class="headerlink" title="特征选择"></a>特征选择</h5><p>在实际应用中，特征数量往往非常多，其中即包含了我们需要的与目标相关的特征，也有一些完全不相关的特征，并且特征之间也可能存在相互依赖。这会导致对应的模型就越复杂，模型训练和预测需要的计算量就越大，同时也会影响算法的预测能力。<br>特征选取就是从大量的特征中选取一个特征子集，构造出更好的模型（如残差最小）。<br>特征选择分为产生、评估、验证三大步骤，如下图。</p>
<p><img src="https://github.com/moakap/moakap.github.io/assets/6308127/e4162e96-5b35-406a-bfc2-f0644fe42a4d" alt="image"></p>
<p>特征选择的过程 ( M. Dash and H. Liu 1997 )</p>
<h6 id="1-特征生成"><a href="#1-特征生成" class="headerlink" title="1. 特征生成"></a>1. 特征生成</h6><p>特征产生过程是搜索特征子空间的过程。分为一下3大类</p>
<ul>
<li>完全搜索</li>
</ul>
<p>完全搜索又分为穷举搜索（Exhaustive）和非穷举（Non-Exhaustive）两类。</p>
<ul>
<li>广度优先搜索</li>
<li>分支界限搜索</li>
<li>定向搜索</li>
<li>最优有限搜索</li>
<li>启发式搜索<ul>
<li>序列前向选择</li>
<li>序列后向选择</li>
<li>双向搜索</li>
<li>增L去R选择算法</li>
<li>序列浮动选择</li>
<li>决策树</li>
</ul>
</li>
<li>随机搜索<ul>
<li>随机产生序列选择算法</li>
<li>模拟退火算法</li>
<li>遗传算法</li>
</ul>
</li>
</ul>
<h6 id="2-特征评估"><a href="#2-特征评估" class="headerlink" title="2. 特征评估"></a>2. 特征评估</h6><p>评价函数</p>
<ol>
<li>相关性</li>
<li>距离</li>
<li>信息增益</li>
<li>一致性</li>
<li>分类器错误率<h6 id="3-特征验证"><a href="#3-特征验证" class="headerlink" title="3. 特征验证"></a>3. 特征验证</h6><h5 id=""><a href="#" class="headerlink" title=""></a></h5><h5 id="最小角回归-Least-angle-Regression-LARS"><a href="#最小角回归-Least-angle-Regression-LARS" class="headerlink" title="最小角回归(Least-angle Regression, LARS)"></a>最小角回归(Least-angle Regression, LARS)</h5>针对高位数据，最小角回归LARS算法首先是一种逐步向前回归。在逐步向前的每一步中，它都会找到与目标最相关的特征。当特征具有相等的相关性时，它不是沿着相同的特征继续进行，而是沿着特征之间等角的方向进行。</li>
</ol>
<p>参考<a target="_blank" rel="noopener" href="https://www.yuque.com/attachments/yuque/0/2022/pdf/22905381/1647050640766-48899bc1-94c0-4077-acd1-4cc01a2f3f96.pdf?_lake_card=%7B%22src%22:%22https://www.yuque.com/attachments/yuque/0/2022/pdf/22905381/1647050640766-48899bc1-94c0-4077-acd1-4cc01a2f3f96.pdf%22,%22name%22:%22LeastAngle_2002.pdf%22,%22size%22:350701,%22type%22:%22application/pdf%22,%22ext%22:%22pdf%22,%22status%22:%22done%22,%22taskId%22:%22u71c5bfbb-358b-4da0-8f62-c2fdd74f52c%22,%22taskType%22:%22upload%22,%22id%22:%22DQVG6%22,%22card%22:%22file%22%7D">LeastAngle_2002.pdf</a>了解更多最小角回归算法的更多细节。</p>
<h5 id="LARS-Lasso"><a href="#LARS-Lasso" class="headerlink" title="LARS Lasso"></a>LARS Lasso</h5><p>LarsLasso是利用LARS算法实现的LASSO模型，与基于坐标下降的LASSO模型不同，它得到的是分段线性的精确解，是其自身系数范数的函数。<br><img src="https://github.com/moakap/moakap.github.io/assets/6308127/32e0ee89-64ec-4805-9660-4374e5b13ff4" alt="image"></p>
<h5 id="正交匹配追踪（OMP）"><a href="#正交匹配追踪（OMP）" class="headerlink" title="正交匹配追踪（OMP）"></a>正交匹配追踪（OMP）</h5><p>一种类似于最小角回归的前向特征选择方法，正交匹配追踪可以用固定数目的非零元素逼近最优解向量。或者，正交匹配追踪可以针对特定的误差，而不是特定数目的非零系数。</p>
<p>参考 <a target="_blank" rel="noopener" href="https://www.yuque.com/attachments/yuque/0/2022/pdf/22905381/1647053096423-abbbd6a4-e47d-43e5-8311-b82c733eb989.pdf?_lake_card=%7B%22src%22:%22https://www.yuque.com/attachments/yuque/0/2022/pdf/22905381/1647053096423-abbbd6a4-e47d-43e5-8311-b82c733eb989.pdf%22,%22name%22:%22KSVD-OMP-v2.pdf%22,%22size%22:171887,%22type%22:%22application/pdf%22,%22ext%22:%22pdf%22,%22status%22:%22done%22,%22taskId%22:%22ud5d3e5f7-88e3-4f46-b39c-556ad51ae98%22,%22taskType%22:%22upload%22,%22id%22:%22uac6e41f4%22,%22card%22:%22file%22%7D">KSVD-OMP-v2.pdf</a>。</p>
<h5 id="随机梯度下降（SGD）"><a href="#随机梯度下降（SGD）" class="headerlink" title="随机梯度下降（SGD）"></a>随机梯度下降（SGD）</h5><p>随机梯度下降是一种简单而又非常有效的拟合线性模型的方法。当样本数量(和特性数量)非常大时，它特别有用。</p>
<h5 id="感知机-（Perceptron）"><a href="#感知机-（Perceptron）" class="headerlink" title="感知机 （Perceptron）"></a>感知机 （Perceptron）</h5><p><a target="_blank" rel="noopener" href="https://scikit-learn.org.cn/view/384.html">Perceptron</a> 是另一种适用于大规模学习的简单分类算法。有如下默认：</p>
<ul>
<li>它不需要设置学习率</li>
<li>它不需要正则项</li>
<li>它只用错误样本更新模型</li>
</ul>
<p>最后一个特点意味着Perceptron的训练速度略快于带有合页损失(hinge loss)的SGD，<strong>因此得到的模型更稀疏</strong>。</p>
<h5 id="被动感知算法-Passive-Aggressive-Algorithms"><a href="#被动感知算法-Passive-Aggressive-Algorithms" class="headerlink" title="被动感知算法(Passive Aggressive Algorithms)"></a>被动感知算法(Passive Aggressive Algorithms)</h5><p>被动感知算法是一种大规模学习的算法。和感知机相似，因为它们不需要设置学习率。然而，与感知器不同的是，它们包含正则化参数 C 。</p>
<h4 id="广义线性回归（GLM）"><a href="#广义线性回归（GLM）" class="headerlink" title="广义线性回归（GLM）"></a>广义线性回归（GLM）</h4><p>广义线性模型(GLM)以两种方式扩展了线性模型。</p>
<ol>
<li>反向连接函数</li>
</ol>
<p>首先是预测值$\hat y$是否通过反向连接函数$h$连接到输入变量$X$的线性组合。<br>$\hat y(w, X) = h(Xw)$</p>
<ol start="2">
<li>损失函数</li>
</ol>
<p>其次，平方损失函数被一个指数分布的单位偏差$d$所代替 (更准确地说，一个再生指数离散模型(EDM) )。最小化问题变成<br>$\min_w \frac{1}{2n_{samples}}  \sum_i d(y_i, \hat{y_i}) + \frac{\alpha}{2}|w|_2$<br>$\alpha$是L2正则化惩罚项。提供样本权重后，平均值即为加权平均值。</p>
<h5 id="再生指数离散模型-EDM"><a href="#再生指数离散模型-EDM" class="headerlink" title="再生指数离散模型(EDM)"></a>再生指数离散模型(EDM)</h5><p><img src="https://github.com/moakap/moakap.github.io/assets/6308127/e222c2dc-f8bc-4df3-8c71-8ec62cd9452f" alt="image"></p>
<h5 id="TweedieRegressor"><a href="#TweedieRegressor" class="headerlink" title="TweedieRegressor"></a>TweedieRegressor</h5><p>TweedieRegressor为Tweedie分布实现了一个广义线性模型，该模型允许使用适当的$power$参数对上述任何分布进行建模。</p>
<ul>
<li>power = 0: 正态分布。在这种情况下，诸如 <a target="_blank" rel="noopener" href="https://scikit-learn.org.cn/view/399.html">Ridge</a>, <a target="_blank" rel="noopener" href="https://scikit-learn.org.cn/view/404.html">ElasticNet</a> 等特定的估计器通常更合适。</li>
<li>power = 1: 泊松分布。方便起见可以使用 <a target="_blank" rel="noopener" href="https://scikit-learn.org.cn/view/437.html">PoissonRegressor</a> 。然而，它完全等同于 TweedieRegressor(power=1, link=’log’).</li>
<li>power = 2: 伽马分布。方便起见可以使用<a target="_blank" rel="noopener" href="https://scikit-learn.org.cn/view/440.html">GammaRegressor</a> 。然而，它完全等同于 TweedieRegressor(power=2, link=’log’).</li>
<li>power = 3: 逆高斯分布。</li>
</ul>
<h5 id="分配方式选择"><a href="#分配方式选择" class="headerlink" title="分配方式选择"></a>分配方式选择</h5><p>分配方式的选择取决于手头的问题:</p>
<ul>
<li>如果目标值  是计数(非负整数值)或相对频率(非负)，则可以使用带有log-link的泊松偏差。</li>
<li>如果目标值是正的，并且是歪斜的，您可以尝试带有log-link的Gamma偏差。</li>
<li>如果目标值似乎比伽马分布的尾部更重，那么您可以尝试使用逆高斯偏差(或者更高的Tweedie族方差)。</li>
</ul>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><ol>
<li>【SVR回归分析简明教程】<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/33692660">https://zhuanlan.zhihu.com/p/33692660</a></li>
<li>【scikit-learn支持向量机/回归】<a target="_blank" rel="noopener" href="http://scikit-learn.org.cn/view/83.html#">http://scikit-learn.org.cn/view/83.html#</a></li>
<li>【SVR支持向量回归】<a target="_blank" rel="noopener" href="https://scikit-learn.org.cn/view/782.html">https://scikit-learn.org.cn/view/782.html</a></li>
<li>【使用线性与非线性核的支持向量机回归】<a target="_blank" rel="noopener" href="http://scikit-learn.org.cn/view/342.html">http://scikit-learn.org.cn/view/342.html</a></li>
<li>【统计学——回归分析】<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/352694434">https://zhuanlan.zhihu.com/p/352694434</a></li>
<li>【从入门到放弃——线性回归】<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/147297924">https://zhuanlan.zhihu.com/p/147297924</a></li>
<li>【回归模型偏差、方差和残差】<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/50214504">https://zhuanlan.zhihu.com/p/50214504</a></li>
<li>【马氏距离】<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/46626607">https://zhuanlan.zhihu.com/p/46626607</a></li>
<li>【Lasso回归和Ridge回归的区别】<a target="_blank" rel="noopener" href="https://cloud.tencent.com/developer/article/1556213">https://cloud.tencent.com/developer/article/1556213</a></li>
<li>【深入理解L1、L2正则化】<a target="_blank" rel="noopener" href="https://www.cnblogs.com/zingp/p/10375691.html#_label0">https://www.cnblogs.com/zingp/p/10375691.html#_label0</a></li>
<li>【机器学习中正则化项L1和L2的直观理解】<a target="_blank" rel="noopener" href="https://blog.csdn.net/jinping_shi/article/details/52433975">https://blog.csdn.net/jinping_shi/article/details/52433975</a></li>
</ol>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN,en,default">
    <link itemprop="mainEntityOfPage" href="https://moakap.github.io/2022/03/12/ML/ML_basics_and_sklearn_framework/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/snail-filled.png">
      <meta itemprop="name" content="moakap">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Moakap's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/03/12/ML/ML_basics_and_sklearn_framework/" class="post-title-link" itemprop="url">机器学习基础入门和Python sklearn</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-03-12 23:23:51" itemprop="dateCreated datePublished" datetime="2022-03-12T23:23:51+00:00">2022-03-12</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%9C%BB%E8%9C%93%E7%82%B9%E6%B0%B4/" itemprop="url" rel="index"><span itemprop="name">蜻蜓点水</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%9C%BB%E8%9C%93%E7%82%B9%E6%B0%B4/ML/" itemprop="url" rel="index"><span itemprop="name">ML</span></a>
                </span>
            </span>

          
            <span id="/2022/03/12/ML/ML_basics_and_sklearn_framework/" class="post-meta-item leancloud_visitors" data-flag-title="机器学习基础入门和Python sklearn" title="阅读次数">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/2022/03/12/ML/ML_basics_and_sklearn_framework/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2022/03/12/ML/ML_basics_and_sklearn_framework/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>关于机器学习的一些笔记和摘抄整理。</p>
<p><a name="LsXQL"></a></p>
<h2 id="机器学习基础"><a href="#机器学习基础" class="headerlink" title="机器学习基础"></a>机器学习基础</h2><p><a name="VpZBO"></a></p>
<h3 id="机器学习-vs-传统编程"><a href="#机器学习-vs-传统编程" class="headerlink" title="机器学习 vs. 传统编程"></a>机器学习 vs. 传统编程</h3><p><img src="https://user-images.githubusercontent.com/6308127/158024257-4a667037-e685-4875-98a0-71fbf52549c5.png" alt="image"></p>
<p><a name="nnf5g"></a></p>
<h3 id="三种类别"><a href="#三种类别" class="headerlink" title="三种类别"></a>三种类别</h3><p>根据使用场景不同，有可以划分为三大类<br><a name="KCTZE"></a></p>
<h4 id="监督学习"><a href="#监督学习" class="headerlink" title="监督学习"></a>监督学习</h4><p>监督学习是根据已知的方法和规律，对新样本进行分类和预测。<br />监督学习就好比学生在学校学习各种知识和理论的过程。整个过程是在老师的监督下完成，所学知识的应用体现在平时的测试中，并且可以通过对比“标准”答案来不断改进和巩固学习成果，在下一次的测试中取得更好的成绩（预测效果）。根据目的不同，可以有分类和回归（预测）两种：</p>
<ul>
<li>分类 —— 根据事物特征将其划分到已知的类别。<ul>
<li>根据事物的特征，将新遇到的事物（新样本）归类到已知的某个类别。</li>
</ul>
</li>
<li>回归（预测）—— 根据事物的特征和预测将来的发展趋势。<ul>
<li>根据事物的特征和发展规律，预测将来的发展趋势。</li>
</ul>
</li>
</ul>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2022/03/12/ML/ML_basics_and_sklearn_framework/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN,en,default">
    <link itemprop="mainEntityOfPage" href="https://moakap.github.io/2021/08/09/superficial/Retrieve_stock_data_in_Excel/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/snail-filled.png">
      <meta itemprop="name" content="moakap">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Moakap's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/08/09/superficial/Retrieve_stock_data_in_Excel/" class="post-title-link" itemprop="url">在Excel中刷新股票数据</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-08-09 17:20:38" itemprop="dateCreated datePublished" datetime="2021-08-09T17:20:38+00:00">2021-08-09</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%9C%BB%E8%9C%93%E7%82%B9%E6%B0%B4/" itemprop="url" rel="index"><span itemprop="name">蜻蜓点水</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%9C%BB%E8%9C%93%E7%82%B9%E6%B0%B4/Excel/" itemprop="url" rel="index"><span itemprop="name">Excel</span></a>
                </span>
            </span>

          
            <span id="/2021/08/09/superficial/Retrieve_stock_data_in_Excel/" class="post-meta-item leancloud_visitors" data-flag-title="在Excel中刷新股票数据" title="阅读次数">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/2021/08/09/superficial/Retrieve_stock_data_in_Excel/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2021/08/09/superficial/Retrieve_stock_data_in_Excel/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="在Excel中刷新股票数据"><a href="#在Excel中刷新股票数据" class="headerlink" title="在Excel中刷新股票数据"></a>在Excel中刷新股票数据</h2><h3 id="基本功能"><a href="#基本功能" class="headerlink" title="基本功能"></a>基本功能</h3><p>点击刷新按钮以后，读取excel中某一列保存的股票代码，然后通过股票数据API获取实时数据，并保存到excel中。</p>
<p>如下图，点击刷新按钮，读取D列的股票代码，获取实时数据，并将对应的数据写入到E - L列。<br><img src="https://github.com/moakap/moakap.github.io/assets/6308127/38da88ea-62b1-43a9-a870-688c82593071" alt="image"></p>
<h3 id="基本步骤"><a href="#基本步骤" class="headerlink" title="基本步骤"></a>基本步骤</h3><h4 id="step-1-添加按钮"><a href="#step-1-添加按钮" class="headerlink" title="step-1 添加按钮"></a>step-1 添加按钮</h4><p>通过Developer -&gt; Insert -&gt; Button添加刷新按钮。</p>
<p><img src="https://github.com/moakap/moakap.github.io/assets/6308127/5e08fac2-5c15-413b-9be7-4bc76300e8ef" alt="image"></p>
<p>然后分配宏脚本，这里新定义一个RefreshBtnClicked()。</p>
<figure class="highlight vbscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Option</span> <span class="keyword">Explicit</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">Sub</span> RefreshBtnClicked()</span><br><span class="line">    <span class="comment">&#x27;</span></span><br><span class="line">    Debug.Print <span class="string">&quot;Start Refresh...&quot;</span></span><br><span class="line"><span class="keyword">End</span> <span class="keyword">Sub</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h4 id="step-2-定义股票数据结构类"><a href="#step-2-定义股票数据结构类" class="headerlink" title="step-2 定义股票数据结构类"></a>step-2 定义股票数据结构类</h4><p>定义CStock类(class)，主要目的是方便数据的结构化处理和存储。可以根据需要和使用的股票API接口返回的数据添加、删除对应字段。<br><img src="https://github.com/moakap/moakap.github.io/assets/6308127/a4cb87e9-b1d9-4a75-8fd4-e47573be2d4a" alt="image"></p>
<figure class="highlight vb"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Option</span> <span class="keyword">Explicit</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">Public</span> code <span class="keyword">As</span> <span class="type">String</span> <span class="comment">&#x27;股票代码</span></span><br><span class="line"><span class="keyword">Public</span> name <span class="keyword">As</span> <span class="type">String</span> <span class="comment">&#x27;股票名称</span></span><br><span class="line"><span class="keyword">Public</span> lastClosePrice <span class="keyword">As</span> <span class="type">Double</span> <span class="comment">&#x27;昨收</span></span><br><span class="line"><span class="keyword">Public</span> openPrice <span class="keyword">As</span> <span class="type">Double</span> <span class="comment">&#x27;今开</span></span><br><span class="line"><span class="keyword">Public</span> currPrice <span class="keyword">As</span> <span class="type">Double</span> <span class="comment">&#x27;最新价格</span></span><br><span class="line"><span class="keyword">Public</span> maxPrice <span class="keyword">As</span> <span class="type">Double</span> <span class="comment">&#x27;最高</span></span><br><span class="line"><span class="keyword">Public</span> minPrice <span class="keyword">As</span> <span class="type">Double</span> <span class="comment">&#x27;最低</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">Public</span> volume <span class="keyword">As</span> <span class="type">Double</span> <span class="comment">&#x27;</span></span><br><span class="line"><span class="keyword">Public</span> turnover <span class="keyword">As</span> <span class="type">Double</span></span><br><span class="line"><span class="keyword">Public</span> lastUpdateDate <span class="keyword">As</span> <span class="type">String</span></span><br><span class="line"><span class="keyword">Public</span> lastUpdateTime <span class="keyword">As</span> <span class="type">String</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&#x27; Get current increase (%) - 获取今日涨幅</span></span><br><span class="line"><span class="keyword">Public</span> <span class="keyword">Property</span> <span class="keyword">Get</span> increaseRate() <span class="keyword">As</span> <span class="type">Double</span></span><br><span class="line">    increaseRate = Round((currPrice - lastClosePrice) / lastClosePrice * <span class="number">100</span>, <span class="number">2</span>)</span><br><span class="line"><span class="keyword">End</span> <span class="keyword">Property</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h4 id="step-3-检查股票代码"><a href="#step-3-检查股票代码" class="headerlink" title="step-3 检查股票代码"></a>step-3 检查股票代码</h4><p>接下来为了排除非法股票代码，通过代码首两个字母做一个简单的筛选，比如沪市(sh开头)、深市(sz开头)和港股(hk开头)。</p>
<figure class="highlight vb"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Public</span> <span class="keyword">Enum</span> STOCK_MKT</span><br><span class="line">    MKT_HK</span><br><span class="line">    MKT_SH</span><br><span class="line">    MKT_SZ</span><br><span class="line">    MKT_INVALID</span><br><span class="line"><span class="keyword">End</span> <span class="keyword">Enum</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&#x27;Get Market type by stock code.</span></span><br><span class="line"><span class="keyword">Function</span> GetMarketType(stockCode <span class="keyword">As</span> <span class="type">String</span>) <span class="keyword">As</span> STOCK_MKT</span><br><span class="line">    <span class="keyword">Dim</span> code <span class="keyword">As</span> <span class="type">String</span></span><br><span class="line">    code = LCase(stockCode)</span><br><span class="line">    </span><br><span class="line">    GetMarketType = MKT_INVALID</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">If</span> InStr(code, <span class="string">&quot;hk&quot;</span>) = <span class="number">1</span> <span class="keyword">Then</span></span><br><span class="line">        GetMarketType = MKT_HK</span><br><span class="line">        <span class="keyword">GoTo</span> Done</span><br><span class="line">    <span class="keyword">End</span> <span class="keyword">If</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">If</span> InStr(code, <span class="string">&quot;sh&quot;</span>) = <span class="number">1</span> <span class="keyword">Then</span></span><br><span class="line">        GetMarketType = MKT_SH</span><br><span class="line">        <span class="keyword">GoTo</span> Done</span><br><span class="line">    <span class="keyword">End</span> <span class="keyword">If</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">If</span> InStr(code, <span class="string">&quot;sz&quot;</span>) = <span class="number">1</span> <span class="keyword">Then</span></span><br><span class="line">        GetMarketType = MKT_SZ</span><br><span class="line">        <span class="keyword">GoTo</span> Done</span><br><span class="line">    <span class="keyword">End</span> <span class="keyword">If</span></span><br><span class="line">    </span><br><span class="line"><span class="symbol">Done:</span></span><br><span class="line">    <span class="comment">&#x27;xxx</span></span><br><span class="line">    </span><br><span class="line"><span class="keyword">End</span> <span class="keyword">Function</span></span><br></pre></td></tr></table></figure>



<h4 id="step-4-API获取数据"><a href="#step-4-API获取数据" class="headerlink" title="step-4 API获取数据"></a>step-4 API获取数据</h4><p>通过API获取实时数据。这里以sina的股票数据为例，接口支持同时获取多个股票的数据（以逗号分开）。</p>
<figure class="highlight vb"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Function</span> GetStockDataByCode(stockCode <span class="keyword">As</span> <span class="type">String</span>) <span class="keyword">As</span> Collection</span><br><span class="line">    <span class="keyword">On</span> <span class="keyword">Error</span> <span class="keyword">GoTo</span> Oops</span><br><span class="line"></span><br><span class="line">    <span class="keyword">Dim</span> url <span class="keyword">As</span> <span class="type">String</span></span><br><span class="line">    url = <span class="string">&quot;http://hq.sinajs.cn/list=&quot;</span> + stockCode</span><br><span class="line">    </span><br><span class="line">    <span class="comment">&#x27; define stock</span></span><br><span class="line">    <span class="keyword">Dim</span> stocks <span class="keyword">As</span> Collection</span><br><span class="line">    <span class="keyword">Set</span> stocks = <span class="built_in">New</span> Collection</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">Dim</span> stock <span class="keyword">As</span> CStock</span><br><span class="line">        </span><br><span class="line">    <span class="comment">&#x27; request stock data</span></span><br><span class="line">    <span class="keyword">Dim</span> http <span class="keyword">As</span> <span class="type">Object</span></span><br><span class="line">    <span class="keyword">Set</span> http = CreateObject(<span class="string">&quot;Microsoft.XMLHTTP&quot;</span>)</span><br><span class="line">    http.Open <span class="string">&quot;POST&quot;</span>, url, <span class="literal">False</span></span><br><span class="line">    http.send <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">If</span> http.Status = <span class="number">200</span> <span class="keyword">Then</span></span><br><span class="line">        <span class="comment">&#x27; split by &quot;;&quot;</span></span><br><span class="line">        <span class="keyword">Dim</span> stockList <span class="keyword">As</span> Variant</span><br><span class="line">        stockList = Split(http.responseText, <span class="string">&quot;;&quot;</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">Dim</span> item <span class="keyword">As</span> Variant</span><br><span class="line">        <span class="keyword">Dim</span> stockDataStr <span class="keyword">As</span> <span class="type">String</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">For</span> <span class="keyword">Each</span> item <span class="keyword">In</span> stockList</span><br><span class="line">            stockDataStr = item</span><br><span class="line">            <span class="keyword">If</span> Len(stockDataStr) &gt; <span class="number">6</span> <span class="keyword">Then</span></span><br><span class="line">                <span class="keyword">Set</span> stock = ParseSingleLine(stockDataStr)</span><br><span class="line">                stocks.Add stock</span><br><span class="line">            <span class="keyword">End</span> <span class="keyword">If</span></span><br><span class="line">            </span><br><span class="line">            <span class="comment">&#x27;release control to OS</span></span><br><span class="line">            DoEvents</span><br><span class="line">        <span class="keyword">Next</span></span><br><span class="line">        </span><br><span class="line">    <span class="keyword">End</span> <span class="keyword">If</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">Set</span> GetStockDataByCode = stocks</span><br><span class="line"><span class="symbol">Oops:</span></span><br><span class="line">    <span class="comment">&#x27;</span></span><br><span class="line">    Debug.Print <span class="string">&quot;[GetStockDataByCode] Error when handling stock: &quot;</span> &amp; stockCode</span><br><span class="line">    </span><br><span class="line">    <span class="comment">&#x27; 释放内存</span></span><br><span class="line">    <span class="keyword">Set</span> stock = <span class="literal">Nothing</span></span><br><span class="line">    <span class="keyword">Set</span> stocks = <span class="literal">Nothing</span></span><br><span class="line">    </span><br><span class="line"><span class="keyword">End</span> <span class="keyword">Function</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">Function</span> ParseSingleLine(stockData <span class="keyword">As</span> <span class="type">String</span>) <span class="keyword">As</span> CStock</span><br><span class="line">    <span class="keyword">Dim</span> Data <span class="keyword">As</span> Variant</span><br><span class="line">    Data = Split(stockData, <span class="string">&quot;,&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment">&#x27;check data length</span></span><br><span class="line">    <span class="keyword">Dim</span> dataLength <span class="keyword">As</span> <span class="type">Integer</span></span><br><span class="line">    dataLength = UBound(Data) - LBound(Data)</span><br><span class="line">    <span class="keyword">If</span> dataLength &lt; <span class="number">3</span> <span class="keyword">Then</span></span><br><span class="line">        <span class="comment">&#x27;如果数据长度小于3，直接返回</span></span><br><span class="line">        <span class="keyword">Set</span> ParseSingleLine = <span class="literal">Nothing</span></span><br><span class="line">        <span class="keyword">GoTo</span> Oops</span><br><span class="line">    <span class="keyword">End</span> <span class="keyword">If</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">Dim</span> stock <span class="keyword">As</span> CStock</span><br><span class="line">    <span class="keyword">Dim</span> mkt <span class="keyword">As</span> STOCK_MKT</span><br><span class="line">    <span class="keyword">Dim</span> stockCode <span class="keyword">As</span> <span class="type">String</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">&#x27; get stockCode</span></span><br><span class="line">    stockCode = Split(Split(Data(<span class="number">0</span>), <span class="string">&quot;=&quot;</span>)(<span class="number">0</span>), <span class="string">&quot;_&quot;</span>)(<span class="number">2</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">Set</span> stock = <span class="built_in">New</span> CStock</span><br><span class="line">    </span><br><span class="line">    <span class="comment">&#x27;check whether it&#x27;s hk code</span></span><br><span class="line">    mkt = GetMarketType(stockCode)</span><br><span class="line">    <span class="keyword">If</span> mkt = MKT_HK <span class="keyword">Then</span></span><br><span class="line">        stock.code = stockCode</span><br><span class="line">        stock.name = Data(<span class="number">1</span>)</span><br><span class="line">        </span><br><span class="line">        stock.openPrice = Data(<span class="number">2</span>)</span><br><span class="line">        stock.lastClosePrice = Data(<span class="number">3</span>)</span><br><span class="line">        stock.maxPrice = Data(<span class="number">4</span>)</span><br><span class="line">        stock.minPrice = Data(<span class="number">5</span>)</span><br><span class="line">        stock.currPrice = Data(<span class="number">6</span>)</span><br><span class="line"></span><br><span class="line">        stock.lastUpdateDate = Data(<span class="number">17</span>)</span><br><span class="line">        stock.lastUpdateTime = Data(<span class="number">18</span>)</span><br><span class="line">    <span class="keyword">ElseIf</span> mkt = MKT_SH <span class="built_in">Or</span> mkt = MKT_SZ <span class="keyword">Then</span></span><br><span class="line">        stock.code = stockCode</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">Dim</span> nameArray <span class="keyword">As</span> Variant</span><br><span class="line">        nameArray = Split(Data(<span class="number">0</span>), <span class="string">&quot;&quot;&quot;&quot;</span>)</span><br><span class="line">        stock.name = nameArray(<span class="number">1</span>)</span><br><span class="line">        </span><br><span class="line">        stock.openPrice = Data(<span class="number">1</span>)</span><br><span class="line">        stock.lastClosePrice = Data(<span class="number">2</span>)</span><br><span class="line">        stock.currPrice = Data(<span class="number">3</span>)</span><br><span class="line">        stock.maxPrice = Data(<span class="number">4</span>)</span><br><span class="line">        stock.minPrice = Data(<span class="number">5</span>)</span><br><span class="line">        stock.volume = Data(<span class="number">8</span>)</span><br><span class="line">        stock.turnover = Data(<span class="number">9</span>)</span><br><span class="line">        stock.lastUpdateDate = Data(<span class="number">30</span>)</span><br><span class="line">        stock.lastUpdateTime = Data(<span class="number">31</span>)</span><br><span class="line">    <span class="keyword">End</span> <span class="keyword">If</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">Set</span> ParseSingleLine = stock</span><br><span class="line">    </span><br><span class="line"><span class="symbol">Oops:</span></span><br><span class="line">    <span class="comment">&#x27;MsgBox &quot;[ParseSingleLine] Error when handling stockData: &quot; &amp; stockData</span></span><br><span class="line">    Debug.Print <span class="string">&quot;Error when parsing stockData &quot;</span> &amp; stockData</span><br><span class="line"><span class="keyword">End</span> <span class="keyword">Function</span></span><br></pre></td></tr></table></figure>



<h4 id="Step-5-将CStock数据写入到excel指定单元格"><a href="#Step-5-将CStock数据写入到excel指定单元格" class="headerlink" title="Step-5 将CStock数据写入到excel指定单元格"></a>Step-5 将CStock数据写入到excel指定单元格</h4><p>更新数据到Excel的基本逻辑很简单，就是直接在股票代码的右侧按顺序写入数据。</p>
<figure class="highlight vb"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&#x27;Write stock data to the right columns of the code column</span></span><br><span class="line"><span class="keyword">Function</span> WriteSingleStockDataToTable(stock <span class="keyword">As</span> CStock, codeRow <span class="keyword">As</span> <span class="type">Integer</span>, codeCol <span class="keyword">As</span> <span class="type">Integer</span>, <span class="keyword">Optional</span> IncludeDetails <span class="keyword">As</span> <span class="type">Boolean</span> = <span class="literal">False</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">Dim</span> sngStart <span class="keyword">As</span> <span class="type">Single</span></span><br><span class="line">    sngStart = Timer</span><br><span class="line">    </span><br><span class="line">    <span class="comment">&#x27; update current price and increase rate</span></span><br><span class="line">    Cells(codeRow, codeCol + <span class="number">1</span>) = stock.increaseRate</span><br><span class="line">    Cells(codeRow, codeCol + <span class="number">2</span>) = stock.currPrice</span><br><span class="line">    </span><br><span class="line">    Debug.Print <span class="string">&quot;WriteSingleStockDataToTable() - 基础耗时: &quot;</span> &amp; Timer - sngStart</span><br><span class="line">    </span><br><span class="line">    <span class="comment">&#x27;check if need update more details</span></span><br><span class="line">    <span class="keyword">If</span> IncludeDetails <span class="keyword">Then</span></span><br><span class="line">        Cells(codeRow, codeCol + <span class="number">3</span>) = stock.lastClosePrice</span><br><span class="line">        Cells(codeRow, codeCol + <span class="number">4</span>) = stock.openPrice</span><br><span class="line">        Cells(codeRow, codeCol + <span class="number">5</span>) = stock.maxPrice</span><br><span class="line">        Cells(codeRow, codeCol + <span class="number">6</span>) = stock.minPrice</span><br><span class="line">        Cells(codeRow, codeCol + <span class="number">7</span>) = stock.volume</span><br><span class="line">        Cells(codeRow, codeCol + <span class="number">8</span>) = stock.turnover</span><br><span class="line">        </span><br><span class="line">        Debug.Print <span class="string">&quot;WriteSingleStockDataToTable() - 完整耗时: &quot;</span> &amp; Timer - sngStart</span><br><span class="line">    <span class="keyword">End</span> <span class="keyword">If</span></span><br><span class="line">    </span><br><span class="line"><span class="keyword">End</span> <span class="keyword">Function</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&#x27;Write multiple stock data to the right columns of code</span></span><br><span class="line"><span class="keyword">Function</span> WriteStockListDataToTable(codeCol <span class="keyword">As</span> <span class="type">Integer</span>, codeDict <span class="keyword">As</span> <span class="type">Object</span>, stocks <span class="keyword">As</span> Collection, <span class="keyword">Optional</span> IncludeDetails <span class="keyword">As</span> <span class="type">Boolean</span> = <span class="literal">False</span>)</span><br><span class="line">    <span class="keyword">Dim</span> item <span class="keyword">As</span> CStock</span><br><span class="line">    <span class="keyword">Dim</span> codeRow <span class="keyword">As</span> <span class="type">Integer</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">For</span> <span class="keyword">Each</span> item <span class="keyword">In</span> stocks</span><br><span class="line">        codeRow = codeDict.item(item.code)</span><br><span class="line">        <span class="keyword">Call</span> WriteSingleStockDataToTable(item, codeRow, codeCol, IncludeDetails)</span><br><span class="line">    <span class="keyword">Next</span></span><br><span class="line"><span class="keyword">End</span> <span class="keyword">Function</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h4 id="Step-6-刷新整个列表"><a href="#Step-6-刷新整个列表" class="headerlink" title="Step-6 刷新整个列表"></a>Step-6 刷新整个列表</h4><p>考虑到API支持的参数，使用了分批刷新的方式，每次获取的股票数量为<code>batchSize</code>. 这里发现一个问题，向excel单元格写入数据的耗时会随着写入数据的数量成比例增加，为了优化每次更新的时间，可以通过<code>getDetails</code>选择是否写入详细数据。</p>
<figure class="highlight vb"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&#x27;</span></span><br><span class="line"><span class="keyword">Sub</span> RefreshBtnClicked()</span><br><span class="line">    <span class="comment">&#x27;</span></span><br><span class="line">    Debug.Print <span class="string">&quot;Start Refresh()...&quot;</span></span><br><span class="line">    <span class="keyword">Dim</span> sngStart <span class="keyword">As</span> <span class="type">Single</span></span><br><span class="line">    sngStart = Timer</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">Dim</span> codeColumn <span class="keyword">As</span> <span class="type">Integer</span></span><br><span class="line">    <span class="keyword">Dim</span> startRow <span class="keyword">As</span> <span class="type">Integer</span></span><br><span class="line">    <span class="keyword">Dim</span> endRow <span class="keyword">As</span> <span class="type">Integer</span></span><br><span class="line">    <span class="keyword">Dim</span> batchSize <span class="keyword">As</span> <span class="type">Integer</span></span><br><span class="line">    <span class="keyword">Dim</span> getDetails <span class="keyword">As</span> <span class="type">Boolean</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">&#x27; update settings</span></span><br><span class="line">    codeColumn = <span class="number">4</span> <span class="comment">&#x27;股票代码列</span></span><br><span class="line">    startRow = <span class="number">5</span> <span class="comment">&#x27;起始行</span></span><br><span class="line">    endRow = <span class="number">100</span> <span class="comment">&#x27;结束行</span></span><br><span class="line">    batchSize = <span class="number">5</span> <span class="comment">&#x27;一次获取股票个数</span></span><br><span class="line">    getDetails = <span class="literal">True</span> <span class="comment">&#x27;是否更新详情，否则只更新当前涨幅（注意：更新的字段越多，耗时越长）</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">Call</span> RefreshStockListByBatch(codeColumn, startRow, endRow, batchSize, getDetails)</span><br><span class="line">    </span><br><span class="line">    MsgBox <span class="string">&quot;Refresh done, &quot;</span> &amp; Timer - sngStart &amp; <span class="string">&quot;s used.&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">End</span> <span class="keyword">Sub</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">Sub</span> RefreshStockListByBatch(codeColumn <span class="keyword">As</span> <span class="type">Integer</span>, startRow <span class="keyword">As</span> <span class="type">Integer</span>, endRow <span class="keyword">As</span> <span class="type">Integer</span>, batchSize <span class="keyword">As</span> <span class="type">Integer</span>, <span class="keyword">Optional</span> IncludeDetails <span class="keyword">As</span> <span class="type">Boolean</span> = <span class="literal">False</span>)</span><br><span class="line">    <span class="comment">&#x27;refresh my list using one single request</span></span><br><span class="line">    <span class="keyword">Dim</span> row <span class="keyword">As</span> <span class="type">Integer</span></span><br><span class="line">    <span class="keyword">Dim</span> longCode <span class="keyword">As</span> <span class="type">String</span></span><br><span class="line">    <span class="keyword">Dim</span> mkt <span class="keyword">As</span> STOCK_MKT</span><br><span class="line">    <span class="keyword">Dim</span> stockCount <span class="keyword">As</span> <span class="type">Integer</span></span><br><span class="line">    <span class="keyword">Dim</span> stockListData <span class="keyword">As</span> Collection</span><br><span class="line">    <span class="keyword">Dim</span> columnCode <span class="keyword">As</span> <span class="type">String</span></span><br><span class="line">    <span class="keyword">Dim</span> code <span class="keyword">As</span> <span class="type">String</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">&#x27;crete dict to record stock position</span></span><br><span class="line">    <span class="keyword">Dim</span> codeDict <span class="keyword">As</span> <span class="type">Object</span></span><br><span class="line">    <span class="keyword">Set</span> codeDict = CreateObject(<span class="string">&quot;Scripting.Dictionary&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment">&#x27;initialize</span></span><br><span class="line">    longCode = <span class="string">&quot;&quot;</span></span><br><span class="line">    stockCount = <span class="number">0</span></span><br><span class="line">    <span class="keyword">Set</span> stockListData = <span class="built_in">New</span> Collection</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">For</span> row = startRow <span class="keyword">To</span> endRow</span><br><span class="line">        <span class="comment">&#x27;convert to lower case</span></span><br><span class="line">        code = LCase(Cells(row, codeColumn).Value)</span><br><span class="line">        </span><br><span class="line">        <span class="comment">&#x27;construct the long code by &quot;,&quot;, e.g. sh000001,sz300012,sh...</span></span><br><span class="line">        mkt = GetMarketType(code)</span><br><span class="line">        <span class="keyword">If</span> mkt &lt;&gt; MKT_INVALID <span class="keyword">Then</span></span><br><span class="line">            <span class="keyword">If</span> Len(longCode) &gt; <span class="number">0</span> <span class="keyword">Then</span></span><br><span class="line">                longCode = longCode &amp; <span class="string">&quot;,&quot;</span></span><br><span class="line">            <span class="keyword">End</span> <span class="keyword">If</span></span><br><span class="line">            longCode = longCode &amp; code</span><br><span class="line">            </span><br><span class="line">            <span class="comment">&#x27;record stock position</span></span><br><span class="line">            <span class="keyword">If</span> <span class="built_in">Not</span> codeDict.exists(code) <span class="keyword">Then</span></span><br><span class="line">                codeDict.Add code, row</span><br><span class="line">            <span class="keyword">End</span> <span class="keyword">If</span></span><br><span class="line">            </span><br><span class="line">            <span class="comment">&#x27;</span></span><br><span class="line">            stockCount = stockCount + <span class="number">1</span></span><br><span class="line">        <span class="keyword">End</span> <span class="keyword">If</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">&#x27;check and request stock data by longCode</span></span><br><span class="line">        <span class="keyword">If</span> stockCount + <span class="number">1</span> &gt; batchSize <span class="keyword">Then</span></span><br><span class="line">            <span class="comment">&#x27;</span></span><br><span class="line">            <span class="keyword">Set</span> stockListData = GetStockDataByCode(longCode)</span><br><span class="line">            <span class="keyword">Call</span> WriteStockListDataToTable(codeColumn, codeDict, stockListData, IncludeDetails)</span><br><span class="line">            </span><br><span class="line">            <span class="comment">&#x27; reset</span></span><br><span class="line">            <span class="keyword">Set</span> stockListData = <span class="literal">Nothing</span></span><br><span class="line">            <span class="keyword">Set</span> stockListData = <span class="built_in">New</span> Collection</span><br><span class="line">            stockCount = <span class="number">0</span></span><br><span class="line">            longCode = <span class="string">&quot;&quot;</span></span><br><span class="line">            </span><br><span class="line">            <span class="comment">&#x27;release control to OS</span></span><br><span class="line">            DoEvents</span><br><span class="line">        <span class="keyword">End</span> <span class="keyword">If</span></span><br><span class="line">        </span><br><span class="line">    <span class="keyword">Next</span> row</span><br><span class="line">    </span><br><span class="line">    <span class="comment">&#x27;</span></span><br><span class="line">    <span class="keyword">Set</span> stockListData = GetStockDataByCode(longCode)</span><br><span class="line">    <span class="keyword">Call</span> WriteStockListDataToTable(codeColumn, codeDict, stockListData, IncludeDetails)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">Set</span> codeDict = <span class="literal">Nothing</span></span><br><span class="line">    <span class="keyword">Set</span> stockListData = <span class="literal">Nothing</span></span><br><span class="line"><span class="keyword">End</span> <span class="keyword">Sub</span></span><br></pre></td></tr></table></figure>



<h3 id="原始文件"><a href="#原始文件" class="headerlink" title="原始文件"></a>原始文件</h3><p>原始文件可以从<a target="_blank" rel="noopener" href="https://download.csdn.net/download/ljinddlj/20929711">这里</a>下载，代码比较粗糙，欢迎在此基础上加工改造！</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN,en,default">
    <link itemprop="mainEntityOfPage" href="https://moakap.github.io/2021/06/29/React/useMemo-and-useCallback/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/snail-filled.png">
      <meta itemprop="name" content="moakap">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Moakap's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/06/29/React/useMemo-and-useCallback/" class="post-title-link" itemprop="url">React中的useMemo和useCallback</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-06-29 21:51:51" itemprop="dateCreated datePublished" datetime="2021-06-29T21:51:51+00:00">2021-06-29</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%9C%BB%E8%9C%93%E7%82%B9%E6%B0%B4/" itemprop="url" rel="index"><span itemprop="name">蜻蜓点水</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%9C%BB%E8%9C%93%E7%82%B9%E6%B0%B4/React/" itemprop="url" rel="index"><span itemprop="name">React</span></a>
                </span>
            </span>

          
            <span id="/2021/06/29/React/useMemo-and-useCallback/" class="post-meta-item leancloud_visitors" data-flag-title="React中的useMemo和useCallback" title="阅读次数">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/2021/06/29/React/useMemo-and-useCallback/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2021/06/29/React/useMemo-and-useCallback/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="React中的useMemo和useCallback"><a href="#React中的useMemo和useCallback" class="headerlink" title="React中的useMemo和useCallback"></a>React中的useMemo和useCallback</h2><p>先看看二者的<a target="_blank" rel="noopener" href="https://reactjs.org/docs/react-api.html#reactmemo">官方定义</a>。</p>
<h3 id="useMemo"><a href="#useMemo" class="headerlink" title="useMemo"></a>useMemo</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> memoizedValue = useMemo(<span class="function">() =&gt;</span> computeExpensiveValue(a, b), [a, b]);</span><br></pre></td></tr></table></figure>

<ul>
<li>返回一个带有缓存（记忆）功能的值。</li>
<li>输入<ul>
<li>create函数（用来创建/生成要缓存的值，所以叫create函数）</li>
<li>依赖项列表（指明什么时候需要重新计算并覆盖之前缓存的值）</li>
</ul>
</li>
</ul>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2021/06/29/React/useMemo-and-useCallback/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN,en,default">
    <link itemprop="mainEntityOfPage" href="https://moakap.github.io/2021/06/28/React/Hiding-tab-bar-in-specific-screens/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/snail-filled.png">
      <meta itemprop="name" content="moakap">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Moakap's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/06/28/React/Hiding-tab-bar-in-specific-screens/" class="post-title-link" itemprop="url">React Navigation在特定页面隐藏tab菜单栏</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-06-28 16:55:51" itemprop="dateCreated datePublished" datetime="2021-06-28T16:55:51+00:00">2021-06-28</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%9C%BB%E8%9C%93%E7%82%B9%E6%B0%B4/" itemprop="url" rel="index"><span itemprop="name">蜻蜓点水</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%9C%BB%E8%9C%93%E7%82%B9%E6%B0%B4/React/" itemprop="url" rel="index"><span itemprop="name">React</span></a>
                </span>
            </span>

          
            <span id="/2021/06/28/React/Hiding-tab-bar-in-specific-screens/" class="post-meta-item leancloud_visitors" data-flag-title="React Navigation在特定页面隐藏tab菜单栏" title="阅读次数">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/2021/06/28/React/Hiding-tab-bar-in-specific-screens/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2021/06/28/React/Hiding-tab-bar-in-specific-screens/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="React-Navigation在特定页面隐藏tab菜单栏"><a href="#React-Navigation在特定页面隐藏tab菜单栏" class="headerlink" title="React Navigation在特定页面隐藏tab菜单栏"></a>React Navigation在特定页面隐藏tab菜单栏</h2><p>在基于tab的导航应用中，有时候我们需要在某些页面隐藏tab菜单栏。假设这里有5个页面：</p>
<ul>
<li>Home</li>
<li>Feed</li>
<li>Notifications</li>
<li>Profile</li>
<li>Settings</li>
</ul>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2021/06/28/React/Hiding-tab-bar-in-specific-screens/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN,en,default">
    <link itemprop="mainEntityOfPage" href="https://moakap.github.io/2021/06/28/React/React-Navigation-Authentication-Flows/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/snail-filled.png">
      <meta itemprop="name" content="moakap">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Moakap's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/06/28/React/React-Navigation-Authentication-Flows/" class="post-title-link" itemprop="url">React Navigation中的登录认证流程</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-06-28 16:45:51" itemprop="dateCreated datePublished" datetime="2021-06-28T16:45:51+00:00">2021-06-28</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%9C%BB%E8%9C%93%E7%82%B9%E6%B0%B4/" itemprop="url" rel="index"><span itemprop="name">蜻蜓点水</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%9C%BB%E8%9C%93%E7%82%B9%E6%B0%B4/React/" itemprop="url" rel="index"><span itemprop="name">React</span></a>
                </span>
            </span>

          
            <span id="/2021/06/28/React/React-Navigation-Authentication-Flows/" class="post-meta-item leancloud_visitors" data-flag-title="React Navigation中的登录认证流程" title="阅读次数">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/2021/06/28/React/React-Navigation-Authentication-Flows/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2021/06/28/React/React-Navigation-Authentication-Flows/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>大部分应用需要某种方式的用户认证，以便用户可以访问个人相关的数据或其它隐私数据。典型的流程是这样的：</p>
<ul>
<li>用户打开app</li>
<li>app从加密的持久存储中加载认证信息</li>
<li>加载完以后，根据用户认证状态，用户会跳转到认证页面，或者到app主页面。</li>
<li>如果用户退出登录，我们清理用户的认证信息，并且跳转回认证页面。</li>
</ul>
<p>注意：这里说的认证页面，就是指跟登录相关的页面，比如登录、注册、忘记密码等。</p>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2021/06/28/React/React-Navigation-Authentication-Flows/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN,en,default">
    <link itemprop="mainEntityOfPage" href="https://moakap.github.io/2021/06/24/Swarm/Run_Bee_in_Swarm_Mainnet/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/snail-filled.png">
      <meta itemprop="name" content="moakap">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Moakap's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/06/24/Swarm/Run_Bee_in_Swarm_Mainnet/" class="post-title-link" itemprop="url">Swarm主网运行Bee</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-06-24 10:19:55" itemprop="dateCreated datePublished" datetime="2021-06-24T10:19:55+00:00">2021-06-24</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%9C%BB%E8%9C%93%E7%82%B9%E6%B0%B4/" itemprop="url" rel="index"><span itemprop="name">蜻蜓点水</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%9C%BB%E8%9C%93%E7%82%B9%E6%B0%B4/Swarm/" itemprop="url" rel="index"><span itemprop="name">Swarm</span></a>
                </span>
            </span>

          
            <span id="/2021/06/24/Swarm/Run_Bee_in_Swarm_Mainnet/" class="post-meta-item leancloud_visitors" data-flag-title="Swarm主网运行Bee" title="阅读次数">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/2021/06/24/Swarm/Run_Bee_in_Swarm_Mainnet/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2021/06/24/Swarm/Run_Bee_in_Swarm_Mainnet/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>Swarm主网与6月21日上线，根据<a target="_blank" rel="noopener" href="https://medium.com/ethereum-swarm/swarm-airdrop-is-finishing-on-21-june-2021-important-notice-to-all-participants-6a58f29017a2">官方通知</a>，所有测试网的活动都会结束，之前参与空投的节点需要在7月12号之前把之前兑现。</p>
<h2 id="空投安排"><a href="#空投安排" class="headerlink" title="空投安排"></a>空投安排</h2><ul>
<li>6月21日: 主网上线，空投截至</li>
<li>6月21日 - 7月12日: 支票兑现，收到支票但没有兑现的节点不能参与空投。</li>
<li>7月15日: Swarm基金会公布信任节点(trusted nodes)，并部署空投BZZ (aBZZ - airdrop BZZ)到Goerli测试网。根据官方说法，到时候会发布一个专门的应用。通过空投应用可以查看自己的节点是否会收到空投以及对应的aBZZ币数量。</li>
<li>7月15日 - 21日: 所有人可以在官网查看自己的aBZZ账户，参与者可以将aBZZ集中的某一个账户，用来在主网接收BZZ。</li>
<li>7月22日: aBZZ转移截止。</li>
<li>8月2日: 派发BZZ，测试网Goerli的aBZZ会转化成xDai中的BZZ。</li>
</ul>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2021/06/24/Swarm/Run_Bee_in_Swarm_Mainnet/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN,en,default">
    <link itemprop="mainEntityOfPage" href="https://moakap.github.io/2021/06/08/React/CORS/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/snail-filled.png">
      <meta itemprop="name" content="moakap">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Moakap's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/06/08/React/CORS/" class="post-title-link" itemprop="url">No 'Access-Control-Allow-Origin' header is present on the requested resource.</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-06-08 18:48:24" itemprop="dateCreated datePublished" datetime="2021-06-08T18:48:24+00:00">2021-06-08</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%9C%BB%E8%9C%93%E7%82%B9%E6%B0%B4/" itemprop="url" rel="index"><span itemprop="name">蜻蜓点水</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%9C%BB%E8%9C%93%E7%82%B9%E6%B0%B4/%E5%90%8E%E7%AB%AF%E5%BC%80%E5%8F%91/" itemprop="url" rel="index"><span itemprop="name">后端开发</span></a>
                </span>
            </span>

          
            <span id="/2021/06/08/React/CORS/" class="post-meta-item leancloud_visitors" data-flag-title="No 'Access-Control-Allow-Origin' header is present on the requested resource." title="阅读次数">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/2021/06/08/React/CORS/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2021/06/08/React/CORS/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <blockquote>
<p>No ‘Access-Control-Allow-Origin’ header is present on the requested resource. </p>
</blockquote>
<h2 id="CORS是什么？"><a href="#CORS是什么？" class="headerlink" title="CORS是什么？"></a>CORS是什么？</h2><p><strong>CORS</strong> （Cross-Origin Resource Sharing，跨域资源共享）是一个系统，它由一系列传输的<a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Glossary/HTTP_header">HTTP头</a>组成，这些HTTP头决定浏览器是否阻止前端 JavaScript 代码获取跨域请求的响应。<br><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/Security/Same-origin_policy">同源安全策略</a> （<strong>same-origin policy</strong>）默认阻止“跨域”获取资源。但是 CORS 给了web服务器这样的权限，即服务器可以选择，允许跨域请求访问到它们的资源。</p>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2021/06/08/React/CORS/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="moakap"
      src="/images/snail-filled.png">
  <p class="site-author-name" itemprop="name">moakap</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">20</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">10</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">32</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/moakap" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;moakap" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 2021 – 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">moakap</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://mist.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Mist</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  













<script>
if (document.querySelectorAll('pre.mermaid').length) {
  NexT.utils.getScript('//cdn.jsdelivr.net/npm/mermaid@8/dist/mermaid.min.js', () => {
    mermaid.initialize({
      theme    : 'forest',
      logLevel : 3,
      flowchart: { curve     : 'linear' },
      gantt    : { axisFormat: '%m/%d/%Y' },
      sequence : { actorMargin: 50 }
    });
  }, window.mermaid);
}
</script>


  

  


<script>
NexT.utils.loadComments(document.querySelector('#valine-comments'), () => {
  NexT.utils.getScript('//unpkg.com/valine/dist/Valine.min.js', () => {
    var GUEST = ['nick', 'mail', 'link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item => {
      return GUEST.includes(item);
    });
    new Valine({
      el         : '#valine-comments',
      verify     : false,
      notify     : false,
      appId      : 'AjpQWK4TAFokhRL5FftLIpHr-gzGzoHsz',
      appKey     : 'Lt5JkPmORcKiBCx0RvGPVcNP',
      placeholder: "Just go go",
      avatar     : 'mm',
      meta       : guest,
      pageSize   : '10' || 10,
      visitor    : true,
      lang       : 'zh-cn' || 'zh-cn',
      path       : location.pathname,
      recordIP   : true,
      serverURLs : ''
    });
  }, window.Valine);
});
</script>

</body>
</html>
