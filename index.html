<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"moakap.github.io","root":"/","scheme":"Mist","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":"valine","storage":true,"lazyload":false,"nav":null,"activeClass":"valine"},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta property="og:type" content="website">
<meta property="og:title" content="Moakap&#39;s Blog">
<meta property="og:url" content="https://moakap.github.io/index.html">
<meta property="og:site_name" content="Moakap&#39;s Blog">
<meta property="og:locale">
<meta property="article:author" content="moakap">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://moakap.github.io/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh'
  };
</script>

  <title>Moakap's Blog</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Moakap's Blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">Keep moving, keep thinking!</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags<span class="badge">8</span></a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories<span class="badge">0</span></a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives<span class="badge">7</span></a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh">
    <link itemprop="mainEntityOfPage" href="https://moakap.github.io/2021/05/26/the-1st-post/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="moakap">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Moakap's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/05/26/the-1st-post/" class="post-title-link" itemprop="url">The 1st blog.</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2021-05-26 18:52:51" itemprop="dateCreated datePublished" datetime="2021-05-26T18:52:51+00:00">2021-05-26</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2021-05-28 01:18:09" itemprop="dateModified" datetime="2021-05-28T01:18:09+00:00">2021-05-28</time>
              </span>

          
            <span id="/2021/05/26/the-1st-post/" class="post-meta-item leancloud_visitors" data-flag-title="The 1st blog." title="Views">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">Views: </span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine: </span>
    
    <a title="valine" href="/2021/05/26/the-1st-post/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2021/05/26/the-1st-post/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>This is the 1st post of the blog. </p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh">
    <link itemprop="mainEntityOfPage" href="https://moakap.github.io/2021/05/26/Swarm/Swarm-Bee-Configuration/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="moakap">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Moakap's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/05/26/Swarm/Swarm-Bee-Configuration/" class="post-title-link" itemprop="url">Swarm Bee配置</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2021-05-26 12:52:51" itemprop="dateCreated datePublished" datetime="2021-05-26T12:52:51+00:00">2021-05-26</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2021-05-28 01:18:09" itemprop="dateModified" datetime="2021-05-28T01:18:09+00:00">2021-05-28</time>
              </span>

          
            <span id="/2021/05/26/Swarm/Swarm-Bee-Configuration/" class="post-meta-item leancloud_visitors" data-flag-title="Swarm Bee配置" title="Views">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">Views: </span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine: </span>
    
    <a title="valine" href="/2021/05/26/Swarm/Swarm-Bee-Configuration/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2021/05/26/Swarm/Swarm-Bee-Configuration/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>每个Bee节点可以在启动的时候添加命令行参数来配置，具体参数可以通过<code>bee start --help</code>查看。</p>
<p>例如下边这个例子，我们打开了Bee的debug API，并且设置debug API的监听端口为6666.</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">bee start \</span><br><span class="line">  --api-addr=:8888 \</span><br><span class="line">  --debug-api-enable=true \</span><br><span class="line">  --debug-api-addr=:6666</span><br></pre></td></tr></table></figure>

<h2 id="配置文件"><a href="#配置文件" class="headerlink" title="配置文件"></a>配置文件</h2><p>Bee节点也可以通过提供<code>--config</code>加yaml配置文件的方式来配置。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bee start --config /home/&lt;user&gt;/bee-config.yaml </span><br></pre></td></tr></table></figure>

<p>提示： 可以通过命令<code>bee printconfig &amp;&gt; bee-default.yaml</code>导出当前配置文件作为默认修改版本。</p>
<h2 id="配置通过软件包管理器安装的Bee"><a href="#配置通过软件包管理器安装的Bee" class="headerlink" title="配置通过软件包管理器安装的Bee"></a>配置通过软件包管理器安装的Bee</h2><p>如果你的Bee是通过<code>apt-get</code>或<code>yum</code>这样的软件包管理器安装的，在安装过程中会自动生成一个配置文件，Bee启动的时候默认使用这个配置文件。</p>
<p>要修改Bee配置，可以直接修改对应的配置文件，然后重启Bee生效。</p>
<p><strong>Linux</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo vi /etc/bee/bee.yaml</span><br><span class="line">sudo systemctl restart bee</span><br></pre></td></tr></table></figure>

<p><strong>Mac OS</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">vi /usr/local/etc/swarm-bee/bee.yaml</span><br><span class="line">brew services restart swarm-bee</span><br></pre></td></tr></table></figure>

<h2 id="自动产生配置文件"><a href="#自动产生配置文件" class="headerlink" title="自动产生配置文件"></a>自动产生配置文件</h2><p>通过命令行启动Bee时候，用<code>printconfig</code>替换<code>start</code>可以很简单的生成Bee的配置文件。</p>
<p><strong>例子</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">bee printconfig \</span><br><span class="line">  --verbosity=5 \</span><br><span class="line">  &amp;&gt; bee-config.yaml</span><br></pre></td></tr></table></figure>

<p>上述命令会生成类似下边的文件内容，其中包含了Bee的默认配置。</p>
<h2 id="配置选项"><a href="#配置选项" class="headerlink" title="配置选项"></a>配置选项</h2><h3 id="全局选项"><a href="#全局选项" class="headerlink" title="全局选项"></a>全局选项</h3><h4 id="–config"><a href="#–config" class="headerlink" title="–config"></a>–config</h4><p>设置Bee配置文件，默认为<code>/home/&lt;user&gt;/.bee.yaml</code>.</p>
<h3 id="启动选项"><a href="#启动选项" class="headerlink" title="启动选项"></a>启动选项</h3><h4 id="–api-addr"><a href="#–api-addr" class="headerlink" title="–api-addr"></a>–api-addr</h4><p>默认 <code>:1633</code>.</p>
<p>Bee API地址和端口。忽略IP地址，会监听所有地址的对应端口。</p>
<h4 id="–bootnode"><a href="#–bootnode" class="headerlink" title="–bootnode"></a>–bootnode</h4><p>默认<code>/dnsaddr/bootnode.ethswarm.org</code>.</p>
<p>设置Bee启动节点的地址（要启动或加入的网络），可以是多个地址。</p>
<p>默认情况下节点会连接到Swarm主网。如果要使用私有或者测试网络，必须配置启动节点。</p>
<h4 id="–clef-signer-enable"><a href="#–clef-signer-enable" class="headerlink" title="–clef-signer-enable"></a>–clef-signer-enable</h4><p>默认<code>false</code>.</p>
<p>如果要使用以太坊的<code>Clef</code>作为独立的交易签名器，设置为<code>true</code>。 Clef是以太坊的新功能，需要相应的规则文件或者运行在高级模式下，用来实现对交易和支票的自动签名。</p>
<h4 id="–clef-signer-endpoint"><a href="#–clef-signer-endpoint" class="headerlink" title="–clef-signer-endpoint"></a>–clef-signer-endpoint</h4><p>默认为当前操作系统下clef的默认路径。</p>
<p>你也可以为你的Clef签名器指定自定义ipc文件。</p>
<h4 id="–clef-signer-ethernum-address"><a href="#–clef-signer-ethernum-address" class="headerlink" title="–clef-signer-ethernum-address"></a>–clef-signer-ethernum-address</h4><p>默认会选择clef下的第一个地址（index 0）。</p>
<p>如果你在Bee Clef中导入了多个key，可以使用这个参数来指定要使用的地址。</p>
<p><strong>注意</strong>：如果在Bee Clef中导入了多个地址，必须为每个Bee节点指定对应的签名器地址，第一个地址也需要配置，因为这些地址在导入的时候可能会重新排序。</p>
<h4 id="–cors-allowed-origins"><a href="#–cors-allowed-origins" class="headerlink" title="–cors-allowed-origins"></a>–cors-allowed-origins</h4><p>默认为<code>[]</code>.</p>
<p>允许的Http/WS API响应地址域。API只会接受对应地址域的请求，例如：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">bee start --cors-allowed-origins=&quot;*&quot;</span><br><span class="line">bee start --cors-allowed-origins=&quot;https://website.ethswarm.org&quot;</span><br></pre></td></tr></table></figure>

<h4 id="–data-dir"><a href="#–data-dir" class="headerlink" title="–data-dir"></a>–data-dir</h4><p>默认<code>/home/&lt;user&gt;/.bee</code>. </p>
<p>Bee数据存储路径。包含以下三种类型的数据。</p>
<ol>
<li><p>区块数据</p>
<p>具体会包含本地pin过的区块数据和文件、缓存的区块数据、或当前节点职责范围内需要提供给对端节点的区块数据。</p>
</li>
<li><p>状态数据</p>
<p>本地Bee节点的状态数据，需要备份。</p>
</li>
<li><p>密钥库（keystore）数据</p>
<p>包含加密过的私钥，需要备份并且保证私密性。</p>
</li>
</ol>
<p><strong>注意：</strong>在秘钥库(keystore)中的文件要保证绝对的安全！它们是你的网络身份的加密标记，一旦丢失无法恢复。</p>
<h4 id="–db-capacity"><a href="#–db-capacity" class="headerlink" title="–db-capacity"></a>–db-capacity</h4><p>默认<code>5000000</code>.</p>
<p>区块数据容量。区块数据已4086byte作为基础单位，所以总的数据库容量（kb）大概为<code>db-capacity * 4096</code>. 默认值5,000,000个区块大概有20.5gb。为了能够在网络中有效工作，我们建议一个Bee节点的容量至少要2.5gb。一些不参与数据存储的节点可以设置更小的容量。</p>
<p>下边4个参数对应更低层级的配置，是针对LevelDB的Openfile函数的配置。</p>
<h5 id="–db-block-cache-capacity"><a href="#–db-block-cache-capacity" class="headerlink" title="–db-block-cache-capacity"></a>–db-block-cache-capacity</h5><p>默认<code>33554432</code>。</p>
<p>对应LevelDB的<code>BlcokCacheCapacity</code>.</p>
<h5 id="–db-disable-seeks-compaction"><a href="#–db-disable-seeks-compaction" class="headerlink" title="–db-disable-seeks-compaction"></a>–db-disable-seeks-compaction</h5><p>默认<code>false</code>. </p>
<p>对应LevelDB的<code>DisableSeeksCompaction</code>.</p>
<h5 id="–db-open-files-limit"><a href="#–db-open-files-limit" class="headerlink" title="–db-open-files-limit"></a>–db-open-files-limit</h5><p>默认<code>200</code>.</p>
<p><strong>注意：</strong>为了兼容低性能的硬件和操作系统，<code>--db-open-files-limit</code>的默认值设置的比较低。建议如果可能的话，增大到接近<code>10000</code>或者更多。</p>
<p>对应LevelDB的<code>OpenFileCacheCapacity</code>.</p>
<h5 id="–db-write-buffer-size"><a href="#–db-write-buffer-size" class="headerlink" title="–db-write-buffer-size"></a>–db-write-buffer-size</h5><p>默认<code>33554432</code>.</p>
<p>对应LevelDB的<code>WriteBuffer</code>. </p>
<h4 id="–debug-api-addr"><a href="#–debug-api-addr" class="headerlink" title="–debug-api-addr"></a>–debug-api-addr</h4><p>默认<code>:1635</code>.</p>
<p>Debug API的地址和端口。忽略地址会监听主机的所有接口。</p>
<p><code>--debug-api-enable</code>必须设置才会生效。</p>
<h4 id="–debug-api-enable"><a href="#–debug-api-enable" class="headerlink" title="–debug-api-enable"></a>–debug-api-enable</h4><p>默认<code>false</code>. </p>
<p>设置为<code>true</code>来打开debug api。</p>
<h4 id="–gateway-mode"><a href="#–gateway-mode" class="headerlink" title="–gateway-mode"></a>–gateway-mode</h4><p>默认<code>false</code>.</p>
<p>设置为<code>true</code>会关闭API中的一些敏感功能，可以使api地址在公共网络中更安全。</p>
<h4 id="–global-pinning-enable"><a href="#–global-pinning-enable" class="headerlink" title="–global-pinning-enable"></a>–global-pinning-enable</h4><p>默认<code>false</code>.</p>
<p>设置为<code>true</code>来打开全局pin功能。</p>
<h4 id="–nat-addr"><a href="#–nat-addr" class="headerlink" title="–nat-addr"></a>–nat-addr</h4><p>默认<code>&quot;&quot;</code>.</p>
<p>设置对应的NAT公网IP。一般情况下会自动生成，一些特殊情况可能需要手工设置。</p>
<h4 id="–network-id"><a href="#–network-id" class="headerlink" title="–network-id"></a>–network-id</h4><p>默认<code>1</code>.</p>
<p>接受新连接的网络ID。主网设置<code>1</code>, 测试网<code>2</code>.</p>
<h4 id="–p2p-addr"><a href="#–p2p-addr" class="headerlink" title="–p2p-addr"></a>–p2p-addr</h4><p>默认<code>:1634</code>.</p>
<p>p2p协议消息的IP地址和端口。</p>
<h4 id="–p2p-quic-enable"><a href="#–p2p-quic-enable" class="headerlink" title="–p2p-quic-enable"></a>–p2p-quic-enable</h4><p>默认<code>false</code>.</p>
<h4 id="–p2p-ws-enable"><a href="#–p2p-ws-enable" class="headerlink" title="–p2p-ws-enable"></a>–p2p-ws-enable</h4><p>默认<code>false</code>.</p>
<p>配置是否打开p2p通信的web-socket传输。</p>
<h4 id="–password"><a href="#–password" class="headerlink" title="–password"></a>–password</h4><p>默认<code>&quot;&quot;</code>.</p>
<p>解密Swarm标识密钥的密码。</p>
<p><strong>注意：</strong>在命令行中设置密码是不安全的。在生成环境中请使用密码文件或环境变量。</p>
<h4 id="–password-file"><a href="#–password-file" class="headerlink" title="–password-file"></a>–password-file</h4><p>默认<code>&quot;&quot;</code>.</p>
<p>指向解密用的密码文件路径。空字符串密码不需要设置。</p>
<h4 id="–payment-early"><a href="#–payment-early" class="headerlink" title="–payment-early"></a>–payment-early</h4><p><em>默认</em> <code>1000000000000</code>.</p>
<p>触发Bee结算的最低结算限制。</p>
<h4 id="–payment-threshold"><a href="#–payment-threshold" class="headerlink" title="–payment-threshold"></a>–payment-threshold</h4><p><em>默认</em> <code>10000000000000</code>.</p>
<p>从对等节点获得付款的最低支付门限，超过这个值才会触发支付。</p>
<h4 id="–payment-tolerance"><a href="#–payment-tolerance" class="headerlink" title="–payment-tolerance"></a>–payment-tolerance</h4><p><em>默认</em> <code>50000000000000</code></p>
<p>可容忍的最大欠债，超过这个门限后Bee会从这个节点断开。</p>
<h4 id="–resolver-options"><a href="#–resolver-options" class="headerlink" title="–resolver-options"></a>–resolver-options</h4><p><em>默认</em> <code>eth:0x00000000000C2E074eC69A0dFb2997BA6C7d2e1e@localhost:8545</code>.</p>
<h4 id="–standalone"><a href="#–standalone" class="headerlink" title="–standalone"></a>–standalone</h4><p><em>默认</em> <code>false</code></p>
<p>如果不想让Bee节点连接网络，设置<code>true</code>. 开发模式下使用。</p>
<h4 id="–swap-enable"><a href="#–swap-enable" class="headerlink" title="–swap-enable"></a>–swap-enable</h4><p><em>默认</em> <code>true</code></p>
<h4 id="–swap-endpoint"><a href="#–swap-endpoint" class="headerlink" title="–swap-endpoint"></a>–swap-endpoint</h4><p><em>默认</em> <code>http://localhost:8545</code></p>
<p>以太坊区块链交换节点。</p>
<h4 id="–swap-factory-address"><a href="#–swap-factory-address" class="headerlink" title="–swap-factory-address"></a>–swap-factory-address</h4><p><em>默认</em> <code>anointed contract for the current blockchain id</code></p>
<h4 id="–swap-initial-deposit"><a href="#–swap-initial-deposit" class="headerlink" title="–swap-initial-deposit"></a>–swap-initial-deposit</h4><p><em>默认</em> <code>100000000000000000</code></p>
<h4 id="–tracing-enable"><a href="#–tracing-enable" class="headerlink" title="–tracing-enable"></a>–tracing-enable</h4><p><em>默认</em> <code>false</code></p>
<h4 id="–tracing-endpoint"><a href="#–tracing-endpoint" class="headerlink" title="–tracing-endpoint"></a>–tracing-endpoint</h4><p><em>默认</em> <code>127.0.0.1:6831</code></p>
<h4 id="–tracing-service-name"><a href="#–tracing-service-name" class="headerlink" title="–tracing-service-name"></a>–tracing-service-name</h4><p><em>默认</em> <code>bee</code></p>
<h4 id="–verbosity"><a href="#–verbosity" class="headerlink" title="–verbosity"></a>–verbosity</h4><p><em>默认</em> <code>info</code></p>
<p>Bee日志等级：0=silent, 1=error, 2=warn, 3=info, 4=debug, 5=trace</p>
<h4 id="–welcome-message"><a href="#–welcome-message" class="headerlink" title="–welcome-message"></a>–welcome-message</h4><p><em>默认</em> <code>&quot;&quot;</code></p>
<p>连接到对端节点时显示的欢迎信息。</p>
<h3 id="环境变量"><a href="#环境变量" class="headerlink" title="环境变量"></a>环境变量</h3><p>可以使用环境变量定义Bee的配置。</p>
<p>在环境变量中定义好对应的值以后，直接在命令行参数中使用。</p>
<p>例如：<code>bee start --api-addr $VARIABLE_NAME</code>。</p>
<h3 id="配置优先级"><a href="#配置优先级" class="headerlink" title="配置优先级"></a>配置优先级</h3><p>Bee配置按照以下优先级（从高到低）加载处理，高优先级中的配置会覆盖低优先级中的值。</p>
<ol>
<li>命令行参数</li>
<li>环境变量</li>
<li>配置文件</li>
</ol>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh">
    <link itemprop="mainEntityOfPage" href="https://moakap.github.io/2021/05/26/Swarm/Install-Bee-under-Ubuntu/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="moakap">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Moakap's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/05/26/Swarm/Install-Bee-under-Ubuntu/" class="post-title-link" itemprop="url">Ubuntu下运行Swarm Bee节点</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2021-05-26 10:52:51" itemprop="dateCreated datePublished" datetime="2021-05-26T10:52:51+00:00">2021-05-26</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2021-05-28 01:18:09" itemprop="dateModified" datetime="2021-05-28T01:18:09+00:00">2021-05-28</time>
              </span>

          
            <span id="/2021/05/26/Swarm/Install-Bee-under-Ubuntu/" class="post-meta-item leancloud_visitors" data-flag-title="Ubuntu下运行Swarm Bee节点" title="Views">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">Views: </span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine: </span>
    
    <a title="valine" href="/2021/05/26/Swarm/Install-Bee-under-Ubuntu/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2021/05/26/Swarm/Install-Bee-under-Ubuntu/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="1-安装"><a href="#1-安装" class="headerlink" title="1. 安装"></a>1. 安装</h2><p>基本安装步骤比较简单，可以直接[Swarm Bee参考官方文档](<a target="_blank" rel="noopener" href="https://docs.ethswarm.org/docs/installation/quick-start">Quick Start | Swarm Bee Client (ethswarm.org)</a>)。</p>
<h3 id="1-1-Bee-Clef安装"><a href="#1-1-Bee-Clef安装" class="headerlink" title="1.1 Bee Clef安装"></a>1.1 Bee Clef安装</h3><p>在安装Bee之前，建议首先[安装Bee Clef软件包](<a target="_blank" rel="noopener" href="https://docs.ethswarm.org/docs/installation/bee-clef/">Clef External Signer | Swarm Bee Client (ethswarm.org)</a>)。[Clef](<a target="_blank" rel="noopener" href="https://github.com/ethereum/go-ethereum/tree/master/cmd/clef">go-ethereum/cmd/clef at master · ethereum/go-ethereum (github.com)</a>)是Go以太坊客户端使用的独立签名器（单独的一个对以太坊交易进行签名认证的服务），能够管理基于key-file的账户和硬钱包账户。[Bee-Clef](<a target="_blank" rel="noopener" href="https://github.com/ethersphere/bee-clef">ethersphere/bee-clef: bee-clef is official ethereum clef binary wrapped and preconfigured for bee as a service (github.com)</a>)则在clef基础上针对bee做了定制化配置。Bee节点可以通过bee-clef来访问Swarm测试网或以太坊主网。当然，你也可以直接在本地运行原生的[clef](<a target="_blank" rel="noopener" href="https://github.com/ethereum/go-ethereum/tree/master/cmd/clef">go-ethereum/cmd/clef at master · ethereum/go-ethereum (github.com)</a>)，然后增加自己的配置在运行Bee。<strong>如果确定要使用Bee-clef，必须在Bee之前先安装Bee Clef。</strong></p>
<h4 id="选择最新版本"><a href="#选择最新版本" class="headerlink" title="选择最新版本"></a>选择最新版本</h4><ul>
<li>打开[Bee-clef下载页面](<a target="_blank" rel="noopener" href="https://github.com/ethersphere/bee-clef/releases/">Releases · ethersphere/bee-clef (github.com)</a>)，查看最新版本。写当前文档时的最新版本为v0.4.12。 </li>
</ul>
<h4 id="安装Bee-Clef"><a href="#安装Bee-Clef" class="headerlink" title="安装Bee-Clef"></a>安装Bee-Clef</h4><ul>
<li><p>下载Bee-clef</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">wget https://github.com/ethersphere/bee-clef/releases/download/v0.4.12/bee-clef_0.4.12_arm64.deb</span><br><span class="line">sudo dpkg -i bee-clef_0.4.12_arm64.deb</span><br></pre></td></tr></table></figure></li>
</ul>
<h4 id="配置Bee-clef"><a href="#配置Bee-clef" class="headerlink" title="配置Bee-clef"></a>配置Bee-clef</h4><p>安装以后的默认配置文件在<code>/etc/bee-clef</code>目录下，包含<code>4byte.json</code>和<code>rules.s</code>两个文件，已经针对Bee做了基本配置，这里不需要特别修改。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> ll /etc/bee-clef/</span></span><br><span class="line">-rw-r--r--  1 root root  163 Feb 25 01:48 4byte.json</span><br><span class="line">-rw-r--r--  1 root root  249 Feb 25 01:48 rules.js</span><br></pre></td></tr></table></figure>



<h4 id="启动Bee-Clef"><a href="#启动Bee-Clef" class="headerlink" title="启动Bee-Clef"></a>启动Bee-Clef</h4><p>在使用后台启动之前，建议先通过手工启动查看bee-clef是否正确安装。正常启动后会有一下的日志打印，其中会出现三个文件路径</p>
<ul>
<li><p><code>/etc/bee-clef/4byte.json</code></p>
<p>4byte数据库文件，包含了默认的Bee需要的一些方法。</p>
</li>
<li><p><code>/etc/bee-clef/rules.js</code> </p>
<p>签名器规则文件，定义了最基本的签名规则。比如一般来说，我们的很多交易或操作需要用户手工确认才能进行。但是也有一些操作，可以在不提示用户的情况下直接允许，比如规则文件里提到的启动、列出账户等。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">function OnSignerStartup() &#123;</span><br><span class="line">    return &quot;Approve&quot;</span><br><span class="line">&#125;</span><br><span class="line">function OnApprovedTx() &#123;</span><br><span class="line">    return &quot;Approve&quot;</span><br><span class="line">&#125;</span><br><span class="line">function ApproveListing() &#123;</span><br><span class="line">    return &quot;Approve&quot;</span><br><span class="line">&#125;</span><br><span class="line">function ApproveTx() &#123;</span><br><span class="line">    return &quot;Approve&quot;</span><br><span class="line">&#125;</span><br><span class="line">function ApproveSignData() &#123;</span><br><span class="line">    return &quot;Approve&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p><code>/var/lib/bee-clef/clef.ipc</code> </p>
<p>这个是bee-clef签名器与Bee节点之间进行通信的IPC通信管道，bee的所有请求都是通过这个管道发送到bee-clef。在接下来Bee的配置文件中也会用到。</p>
<p>bee-clef正常启动后，一旦<code>bee</code>节点开始跟<code>bee-clef</code>交互，日志中每隔几秒或几分钟就会打印<code>INFO [05-11|23:41:53.365] Op approved</code>. </p>
</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> bee-clef-service start</span></span><br><span class="line">bee-clef-service /var/lib/bee-clef /var/lib/bee-clef/password /etc/bee-clef</span><br><span class="line">Waiting for the clef.ipc file to show up at /var/lib/bee-clef/clef.ipc</span><br><span class="line"></span><br><span class="line">WARNING!</span><br><span class="line"></span><br><span class="line">Clef is an account management tool. It may, like any software, contain bugs.</span><br><span class="line"></span><br><span class="line">Please take care to</span><br><span class="line">- backup your keystore files,</span><br><span class="line">- verify that the keystore(s) can be opened with your password.</span><br><span class="line"></span><br><span class="line">Clef is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY;</span><br><span class="line">without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR</span><br><span class="line">PURPOSE. See the GNU General Public License for more details.</span><br><span class="line">INFO [05-11|23:35:49.197] Using stdin/stdout as UI-channel</span><br><span class="line">INFO [05-11|23:35:49.925] Loaded 4byte database                    embeds=146841 locals=4 local=/etc/bee-clef/4byte.json</span><br><span class="line">&#123;&quot;jsonrpc&quot;:&quot;2.0&quot;,&quot;id&quot;:1,&quot;method&quot;:&quot;ui_onInputRequired&quot;,&quot;params&quot;:[&#123;&quot;title&quot;:&quot;Master Password&quot;,&quot;prompt&quot;:&quot;Please enter the password to decrypt the master seed&quot;,&quot;isPassword&quot;:true&#125;]&#125;</span><br><span class="line">Waiting for the clef.ipc file to show up at /var/lib/bee-clef/clef.ipc</span><br><span class="line">INFO [05-11|23:35:51.134] Rule engine configured                   file=/etc/bee-clef/rules.js</span><br><span class="line">INFO [05-11|23:35:51.134] Starting signer                          chainid=5 keystore=/var/lib/bee-clef/keystore light-kdf=true advanced=false</span><br><span class="line">INFO [05-11|23:35:51.135] IPC endpoint opened                      url=/var/lib/bee-clef/clef.ipc</span><br><span class="line">&#123;&quot;jsonrpc&quot;:&quot;2.0&quot;,&quot;method&quot;:&quot;ui_onSignerStartup&quot;,&quot;params&quot;:[&#123;&quot;info&quot;:&#123;&quot;extapi_http&quot;:&quot;n/a&quot;,&quot;extapi_ipc&quot;:&quot;/var/lib/bee-clef/clef.ipc&quot;,&quot;extapi_version&quot;:&quot;6.1.0&quot;,&quot;intapi_version&quot;:&quot;7.0.1&quot;&#125;&#125;]&#125;</span><br><span class="line">INFO [05-11|23:36:12.193] Op approved</span><br><span class="line">INFO [05-11|23:36:12.203] Op approved</span><br><span class="line">INFO [05-11|23:41:53.365] Op approved</span><br><span class="line">INFO [05-11|23:45:04.948] Op approved</span><br><span class="line">INFO [05-11|23:45:08.734] Op approved</span><br></pre></td></tr></table></figure>



<h4 id="Bee-Clef数据存储"><a href="#Bee-Clef数据存储" class="headerlink" title="Bee-Clef数据存储"></a>Bee-Clef数据存储</h4><p>bee-clef的密钥及其它数据默认存储在<code>/var/lib/bee-clef/</code>. </p>
<ul>
<li><code>1e4b791d7af0cf7a42a8/ </code> - bee-clef账户保险库，里边的config.json文件中会保存加密过的key/value配置文件。</li>
<li><code>clef.ipc</code> - 刚才提到的IPC通信管道。</li>
<li><code>keystore/</code> - bee-clef的账户地址。bee通过这个地址接入测试网或主网。</li>
<li><code>masterseed.json</code> - 存放bee-clef密码</li>
<li><code>password</code>账户的密钥文件 </li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> ll /var/lib/bee-clef/</span></span><br><span class="line">total 24</span><br><span class="line">drwxr-x---  4 bee-clef bee-clef 4096 May 11 19:07 ./</span><br><span class="line">drwxr-xr-x 50 root     root     4096 May 11 00:26 ../</span><br><span class="line">drwx------  2 bee-clef bee-clef 4096 May 11 00:24 1e4b791d7af0cf7a42a8/</span><br><span class="line">srw-rw----  1 root     root        0 May 11 19:07 clef.ipc=</span><br><span class="line">drwx------  2 bee-clef bee-clef 4096 May 11 00:24 keystore/</span><br><span class="line">-r--------  1 bee-clef bee-clef  868 May 11 00:24 masterseed.json</span><br><span class="line">-rw-------  1 bee-clef bee-clef   32 May 11 00:24 password</span><br></pre></td></tr></table></figure>



<h3 id="1-2-Bee安装"><a href="#1-2-Bee安装" class="headerlink" title="1.2 Bee安装"></a>1.2 Bee安装</h3><p>安装完bee-clef并确保其正常启动后，我们来安装Bee。</p>
<h4 id="查看最新版本"><a href="#查看最新版本" class="headerlink" title="查看最新版本"></a>查看最新版本</h4><p>先到[Bee版本下载](<a target="_blank" rel="noopener" href="https://github.com/ethersphere/bee/releases/">Releases · ethersphere/bee (github.com)</a>)查看最新版本，当前最新版本为v0.5.3. </p>
<h4 id="下载并安装Bee"><a href="#下载并安装Bee" class="headerlink" title="下载并安装Bee"></a>下载并安装Bee</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">wget https://github.com/ethersphere/bee/releases/download/v0.5.3/bee_0.5.3_amd64.deb</span><br><span class="line">sudo dpkg -i bee_0.5.3_amd64.deb</span><br></pre></td></tr></table></figure>



<h4 id="配置Bee"><a href="#配置Bee" class="headerlink" title="配置Bee"></a>配置Bee</h4><p>安装完毕以后默认配置文件在<code>/etc/bee/bee.yaml</code>。也可以运行<code>bee printconfig &amp;&gt; bee-default.yaml</code>打印当前的Bee配置作为模板来自己修改。其中几个地方需要注意。</p>
<ul>
<li><p>clef配置 - 需要根据Bee-Clef的配置设置对应的IPC路径。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">## enable clef signer</span><br><span class="line">clef-signer-enable: true</span><br><span class="line">## clef signer endpoint</span><br><span class="line">clef-signer-endpoint: /var/lib/bee-clef/clef.ipc</span><br></pre></td></tr></table></figure></li>
<li><p>debug API地址 - 如果需要运行bee-dashboard，必须设置。默认为本机的1635端口，也可以自己修改。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">## debug HTTP API listen address (default &quot;:1635&quot;)</span><br><span class="line">debug-api-addr: 127.0.0.1:1635</span><br><span class="line">## enable debug HTTP API</span><br><span class="line">debug-api-enable: true</span><br></pre></td></tr></table></figure></li>
<li><p>Swap节点 - 以太坊交换节点，也就是接入以太坊的入口节点。必须设置，默认为本机的:8545端口，如果你在本机运行geth （go的以太坊客户端）。否则，推荐使用Warm官方公共节点<code>https://rpc.slock.it/goerli</code>。也可以自己到<a target="_blank" rel="noopener" href="https://infura.io/">Ethereum API | IPFS API &amp; Gateway | ETH Nodes as a Service | Infura</a> 注册一个，使用自己注册的节点来减少拥堵。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">## enable swap (default true)swap-enable: true## swap ethereum blockchain endpoint (default &quot;http://localhost:8545&quot;)swap-endpoint: https://rpc.slock.it/goerli</span><br></pre></td></tr></table></figure></li>
</ul>
<p>其它配置请参考<a target="_blank" rel="noopener" href="https://www.lovpia.com/Swarm/BeeConfiguration">配置文件 – MoDocs (lovpia.com)</a>。</p>
<h4 id="启动运行Bee"><a href="#启动运行Bee" class="headerlink" title="启动运行Bee"></a>启动运行Bee</h4><p>更新完配置文件以后，可以直接通过命令行启动来检测配置是否正确。第一次启动会需要输入密码，同时需要账户有至少10gBZZ作为启动资金。</p>
<h5 id="领取启动资金"><a href="#领取启动资金" class="headerlink" title="领取启动资金"></a>领取启动资金</h5><p>先通过<code>bee-clef-keys</code>命令获取节点的ethernum地址（在产生的<code>bee-clef-jey-xxxx.json</code>文件中<code>address</code>字段）。</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://discord.com/channels/799027393297514537/813744618776428594">faucet-request (discord.com)</a> - 通过faucet机器人领取，是好是坏，碰运气。</li>
<li><a target="_blank" rel="noopener" href="https://faucet.goerli.mudit.blog/">Goerli: Authenticated Faucet (mudit.blog)</a> 需要先在Twitter上发布条信息，然后把twitter链接粘贴到页面里领取，可以一次领取37.5gETH，然后到<a target="_blank" rel="noopener" href="https://bzz.ethswarm.org/">Bzzaar (ethswarm.org)</a>兑换即可，成功率很高，而且可以兑换不止10个gBZZ. </li>
</ul>
<h5 id="运行Bee"><a href="#运行Bee" class="headerlink" title="运行Bee"></a>运行Bee</h5><p>可以直接执行<code>bee start</code>来启动，然后查看运行日志是否正常。如果使用自定义配置文件，就加上<code>--config &lt;path to bee.yaml&gt;</code>。</p>
<p>Bee正常启动以后，会默认监听:1633端口，当日志中出现<code>api address: xxxx</code>时，Bee已经启动。如果打开了debug api，也会在日志中看到<code>debug api address: xxx:1633</code>. </p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> bee start --config bee.yaml Welcome to the Swarm.... Bzzz Bzzzz Bzzzz                \     /            \    o ^ o    /              \ (     ) /   ____________(%%%%%%%)____________  (     /   /  )%%%%%%%(  \   \     )  (___/___/__/           \__\___\___)     (     /  /(%%%%%%%)\  \     )      (__/___/ (%%%%%%%) \___\__)              /(       )\            /   (%%%%%)   \                 (%%%)                   !                   INFO[2021-05-18T13:55:09+08:00] version: 0.5.3-acbd0e2                       INFO[2021-05-18T13:55:09+08:00] using swarm network address through clef: &lt;xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx&gt; INFO[2021-05-18T13:55:09+08:00] swarm public key &lt;xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx&gt;  INFO[2021-05-18T13:55:09+08:00] pss public key &lt;xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx&gt; INFO[2021-05-18T13:55:09+08:00] using ethereum address &lt;xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx&gt;INFO[2021-05-18T13:55:09+08:00] debug api address: 127.0.0.1:1635            INFO[2021-05-18T13:55:11+08:00] using default factory address <span class="keyword">for</span> chain id 5: &lt;xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx&gt; INFO[2021-05-18T13:55:12+08:00] using existing chequebook &lt;xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx&gt; INFO[2021-05-18T13:55:25+08:00] database capacity: 2000000 chunks (approximately 7.8GB) INFO[2021-05-18T13:55:33+08:00] name resolver: no name resolution service provided INFO[2021-05-18T13:55:33+08:00] api address: [::]:1633...<span class="comment"># 注意：其中的xxx为你的Bee节点对应的key和地址信息.</span></span></span><br></pre></td></tr></table></figure>

<p>确保Bee可以正常启动并运行以后，就可以把Bee加入到系统服务后台运行就可以了。</p>
<h4 id="查看Bee基本信息"><a href="#查看Bee基本信息" class="headerlink" title="查看Bee基本信息"></a>查看Bee基本信息</h4><p>最基本的就是在浏览器直接查看<code>localhost:1633</code>, 也可以在命令行用curl命令查看，如果显示<code>Ethereum Swarm Bee</code>就说明已经在运行了。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># curl -s localhost:1633Ethereum Swarm Bee</span><br></pre></td></tr></table></figure>

<p>其它信息可以通过[bee debug api](<a target="_blank" rel="noopener" href="https://docs.ethswarm.org/debug-api/">Bee Debug API (ethswarm.org)</a>)查看。</p>
<p>比如自己做一个简单的bee_health_check.sh脚本，可以快速输出当前Bee节点的基本信息。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">!/usr/bin/env bash<span class="comment"># get addresses of current nodeecho &#x27;====&gt; 获取Bee节点地址...&#x27;echo &#x27;&gt; curl -s localhost:1635/addresses&#x27;curl -s localhost:1635/addresses | jq# check connected peersecho &#x27;====&gt; 获取已经建立连接的节点列表...&#x27;echo &#x27;&gt; curl -s localhost:1635/peers&#x27;curl -s localhost:1635/peers | jq# check balance# echo &#x27;====&gt; 获取账户基本信息...&#x27;# echo &#x27;curl -s localhost:1635/balances&#x27;# curl -s localhost:1635/balances | jq# get chequebook balanceecho &#x27;====&gt; 获取支票账户信息...&#x27;echo &#x27;&gt; curl -s localhost:1635/chequebook/balance&#x27;curl -s localhost:1635/chequebook/balance | jqecho &#x27;====&gt; 获取支票信息...&#x27;echo &#x27;&gt; curl -s localhost:1635/chequebook/cheque&#x27;curl -s localhost:1635/chequebook/cheque | jq</span></span>                             </span><br></pre></td></tr></table></figure>

<p>另外一种方式是直接使用bee-dashboard查看，就是把bee debug api获取的状态通过图形界面可视化。需要提前打开debug api，具体参考[bee-dashboard教程](<a target="_blank" rel="noopener" href="https://github.com/ethersphere/bee-dashboard">ethersphere/bee-dashboard: An app which helps users to setup their Bee node and do actions like cash out cheques (github.com)</a>)。</p>
<h2 id="2-其它注意事项"><a href="#2-其它注意事项" class="headerlink" title="2. 其它注意事项"></a>2. 其它注意事项</h2><h3 id="问题1：could-not-connect-to-backend-at-xxx"><a href="#问题1：could-not-connect-to-backend-at-xxx" class="headerlink" title="问题1：could not connect to backend at xxx"></a>问题1：<code>could not connect to backend at xxx</code></h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">could not connect to backend at https://rpc.slock.it/goerli. In a swap-enabled network a working blockchain node (for goerli network in production) is required. Check your node or specify another node using --swap-endpoint. Error: get chain id: Post &quot;https://rpc.slock.it/goerli&quot;: dial tcp 185.20.210.132:443: i/o timeout</span><br></pre></td></tr></table></figure>

<p>因为Swap节点不可用，或者节点拥堵，建议到<a target="_blank" rel="noopener" href="https://infura.io/">Ethereum API | IPFS API &amp; Gateway | ETH Nodes as a Service | Infura</a> 注册一个自己的节点，避免官方节点拥堵。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh">
    <link itemprop="mainEntityOfPage" href="https://moakap.github.io/2021/05/25/hello-world/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="moakap">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Moakap's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/05/25/hello-world/" class="post-title-link" itemprop="url">Hello World</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2021-05-25 18:52:51" itemprop="dateCreated datePublished" datetime="2021-05-25T18:52:51+00:00">2021-05-25</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2021-05-28 01:18:09" itemprop="dateModified" datetime="2021-05-28T01:18:09+00:00">2021-05-28</time>
              </span>

          
            <span id="/2021/05/25/hello-world/" class="post-meta-item leancloud_visitors" data-flag-title="Hello World" title="Views">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">Views: </span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine: </span>
    
    <a title="valine" href="/2021/05/25/hello-world/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2021/05/25/hello-world/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>Welcome to <a target="_blank" rel="noopener" href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a target="_blank" rel="noopener" href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a target="_blank" rel="noopener" href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a target="_blank" rel="noopener" href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p>
<h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">&quot;My New Post&quot;</span></span><br></pre></td></tr></table></figure>

<p>More info: <a target="_blank" rel="noopener" href="https://hexo.io/docs/writing.html">Writing</a></p>
<h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure>

<p>More info: <a target="_blank" rel="noopener" href="https://hexo.io/docs/server.html">Server</a></p>
<h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure>

<p>More info: <a target="_blank" rel="noopener" href="https://hexo.io/docs/generating.html">Generating</a></p>
<h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure>

<p>More info: <a target="_blank" rel="noopener" href="https://hexo.io/docs/one-command-deployment.html">Deployment</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh">
    <link itemprop="mainEntityOfPage" href="https://moakap.github.io/2021/05/25/React/Context-in-React/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="moakap">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Moakap's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/05/25/React/Context-in-React/" class="post-title-link" itemprop="url">React中的Context</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2021-05-25 18:52:51" itemprop="dateCreated datePublished" datetime="2021-05-25T18:52:51+00:00">2021-05-25</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2021-05-28 01:18:09" itemprop="dateModified" datetime="2021-05-28T01:18:09+00:00">2021-05-28</time>
              </span>

          
            <span id="/2021/05/25/React/Context-in-React/" class="post-meta-item leancloud_visitors" data-flag-title="React中的Context" title="Views">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">Views: </span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine: </span>
    
    <a title="valine" href="/2021/05/25/React/Context-in-React/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2021/05/25/React/Context-in-React/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="Context定义和目的"><a href="#Context定义和目的" class="headerlink" title="Context定义和目的"></a>Context定义和目的</h2><p>Context 提供了一种在组件之间共享数据的方式，而不必显式地通过组件树的逐层传递 props。</p>
<h2 id="应用场景"><a href="#应用场景" class="headerlink" title="应用场景"></a>应用场景</h2><h3 id="哪些数据会需要共享？"><a href="#哪些数据会需要共享？" class="headerlink" title="哪些数据会需要共享？"></a>哪些数据会需要共享？</h3><blockquote>
<p> Context 设计目的是为了共享那些对于一个组件树而言是<strong>“全局”的数据</strong>，例如当前认证的用户、主题或首选语言。</p>
</blockquote>
<h2 id="使用步骤"><a href="#使用步骤" class="headerlink" title="使用步骤"></a>使用步骤</h2><h3 id="1-创建并初始化Context"><a href="#1-创建并初始化Context" class="headerlink" title="1. 创建并初始化Context"></a>1. 创建并初始化Context</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> MyContext = createContex(defaultValue);</span><br></pre></td></tr></table></figure>

<p>创建一个 Context 对象。当 React 渲染一个订阅了这个 Context 对象的组件，这个组件会从组件树中离自身最近的那个匹配的 <code>Provider</code> 中读取到当前的 context 值。</p>
<h3 id="2-订阅Context"><a href="#2-订阅Context" class="headerlink" title="2. 订阅Context"></a>2. 订阅Context</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;MyContext.Provider value=&#123;<span class="comment">/* 某个值 */</span>&#125;&gt;</span><br></pre></td></tr></table></figure>

<p>Provider 接收一个 <code>value</code> 属性，传递给消费组件。一个 Provider 可以和多个消费组件有对应关系。多个 Provider 也可以嵌套使用，里层的会覆盖外层的数据。</p>
<p>这里有两个相关的概念</p>
<ul>
<li>Provider - Context提供者，或Context的订阅者。可以理解为通过Provider为其内部组件订阅了Context值的变动，一旦Context值有变化，就会触发内部组件重新渲染。</li>
<li>Comsumer - Context消费者（消费组件），或者叫Context使用者。即在Provider内部使用<code>useContext()</code>来使用或消费Context的组件。这些组件通过useContext()获取、使用Context的最新值。</li>
</ul>
<h3 id="3-使用Conext"><a href="#3-使用Conext" class="headerlink" title="3. 使用Conext"></a>3. 使用Conext</h3><h4 id="3-1-React组件中使用"><a href="#3-1-React组件中使用" class="headerlink" title="3.1 React组件中使用"></a>3.1 React组件中使用</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> value = useContext(MyContext);</span><br></pre></td></tr></table></figure>

<p>在消费组件中引用Context。value会从组件树中离自身最近的那个匹配的Provider中读取到当前的Context值。</p>
<h4 id="3-2-纯函数式组件中使用"><a href="#3-2-纯函数式组件中使用" class="headerlink" title="3.2 纯函数式组件中使用"></a>3.2 纯函数式组件中使用</h4><p>在纯函数式的组件中，可以使用<code>Consumer</code>来引用context的值。如果没有上层对应的Provider，value等同于传递给<code>createContext()</code>的<code>defaultValue</code>. </p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;MyContext.Consumer&gt;</span><br><span class="line">  &#123;<span class="function"><span class="params">value</span> =&gt;</span> <span class="comment">/* 基于 context 值进行渲染*/</span>&#125;</span><br><span class="line">&lt;/MyContext.Consumer&gt;</span><br></pre></td></tr></table></figure>



<h3 id="4-Context的更新"><a href="#4-Context的更新" class="headerlink" title="4. Context的更新"></a>4. Context的更新</h3><h4 id="4-1-自上而下更新Context"><a href="#4-1-自上而下更新Context" class="headerlink" title="4.1 自上而下更新Context"></a>4.1 自上而下更新Context</h4><p>自上而下更新指的是更新Provider的value值。当 Provider 的 <code>value</code> 值发生变化时，它内部的所有消费组件内通过<code>useContext</code>获取到的值会自动更新，并触发重新渲染。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//App.js</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ....</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">App</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">//...</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// </span></span><br><span class="line">    <span class="keyword">const</span> &#123;contextValue, setContextValue&#125; = React.useState(initialValue);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// function to update the context value</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">updateContext</span>(<span class="params">newValue</span>) </span>&#123;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 更新contextValue, ConsumerComponent1, ConsumerComponent2, ConsumerComponent3, ConsumerComponent11都会触发重新渲染。</span></span><br><span class="line">        setContextValue(newValue)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ...</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="xml"><span class="tag">&lt;<span class="name">App</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">MyContext.Provider</span> <span class="attr">value</span>=<span class="string">&#123;contextValue&#125;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">ConsumerComponent1</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;<span class="name">ConsumerComponent11</span>&gt;</span></span></span><br><span class="line"><span class="xml">    					// ....</span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;/<span class="name">ComsumerComponent11</span>&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;/<span class="name">ConsumerComponent1</span>&gt;</span></span></span><br><span class="line"><span class="xml"></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">ConsumerComponent2</span> /&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">ConsumerComponent3</span> /&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;/<span class="name">MyContext.Provider</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">App</span>&gt;</span></span></span><br><span class="line">    );</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="4-2-自下而上（从消费组件）更新Context"><a href="#4-2-自下而上（从消费组件）更新Context" class="headerlink" title="4.2 自下而上（从消费组件）更新Context"></a>4.2 自下而上（从消费组件）更新Context</h4><p>在某些情况下，需要在某个消费组件内更新<code>context</code>，并且适配到整个程序。比如通过应用程序的<code>setting</code>组件修改UI风格。 这时就需要通过回调将更新一层层传递到对应的Provider，更新Provide对应的<code>value</code>，从而触发所有相关消费组件的更新。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// app.js</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">App</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    ...</span><br><span class="line">    <span class="keyword">const</span> &#123;contextValue, setContextValue&#125; = React.useState(initialValue);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// function to update the context value</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">updateContext</span>(<span class="params">newValue</span>) </span>&#123;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 更新contextValue, ConsumerComponent1, ConsumerComponent2, ConsumerComponent3, ConsumerComponent11都会触发重新渲染。</span></span><br><span class="line">        setContextValue(newValue)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ...</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="xml"><span class="tag">&lt;<span class="name">App</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">MyContext.Provider</span> <span class="attr">value</span>=<span class="string">&#123;contextValue&#125;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">ConsumerComponent1</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;<span class="name">ConsumerComponent11</span> <span class="attr">updateValue</span>=<span class="string">&#123;updateContext&#125;</span>&gt;</span> // 通过回调形式的props, 在ConsumerComponent11中更新contextValue, 因为contextValue属于最顶层的Provider的值，所以也会触发ConsumerComponent1, ConsumerComponent2, ConsumerComponent3重新渲染。</span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;/<span class="name">ComsumerComponent11</span>&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;/<span class="name">ConsumerComponent1</span>&gt;</span></span></span><br><span class="line"><span class="xml"></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">ConsumerComponent2</span> /&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">ConsumerComponent3</span> /&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;/<span class="name">MyContext.Provider</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">App</span>&gt;</span></span></span><br><span class="line">    );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="4-3-Provider嵌套"><a href="#4-3-Provider嵌套" class="headerlink" title="4.3 Provider嵌套"></a>4.3 Provider嵌套</h4><p>在一些情况下，可能会出现同一个Context的provider嵌套的情况，这时候可以理解为两个Context。不同的是，</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line"><span class="keyword">const</span> &#123;contextValue, setContextValue&#125; = React.useState(initialValue);</span><br><span class="line"></span><br><span class="line"><span class="comment">// function to update the context value</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">updateContext</span>(<span class="params">newValue</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 更新contextValue, ConsumerComponent1, ConsumerComponent2, ConsumerComponent3, ConsumerComponent11都会触发重新渲染。</span></span><br><span class="line">    setContextValue(newValue)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"><span class="keyword">return</span> (</span><br><span class="line">	<span class="xml"><span class="tag">&lt;<span class="name">App</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">MyContext.Provider</span> <span class="attr">value</span>=<span class="string">&#123;contextValue&#125;</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">ConsumerComponent1</span>&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">ConsumerComponent11</span> /&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;/<span class="name">ConsumerComponent1</span>&gt;</span></span></span><br><span class="line"><span class="xml"></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">ConsumerComponent2</span>&gt;</span></span></span><br><span class="line"><span class="xml">                ...</span></span><br><span class="line"><span class="xml">                // 如果只希望更新ComsumerComponent21, ComsumerComponent22中的值</span></span><br><span class="line"><span class="xml">                </span></span><br><span class="line"><span class="xml">                const localContextValue = useContext(MyContext); // 从上一层Provider中获取当前值</span></span><br><span class="line"><span class="xml"></span></span><br><span class="line"><span class="xml">				const &#123;tempContextValue, setTempContextValue&#125; = React.useState(localContextValue);</span></span><br><span class="line"><span class="xml"></span></span><br><span class="line"><span class="xml">				function updateTempContext(newValue) &#123;</span></span><br><span class="line"><span class="xml">                    // 这里更新以后只会触发ConsumerComponent21和ConsumerComponent22的重新渲染</span></span><br><span class="line"><span class="xml">                    setTempContextValue(newValue); </span></span><br><span class="line"><span class="xml">                &#125;</span></span><br><span class="line"><span class="xml"></span></span><br><span class="line"><span class="xml">				// 这里新建Provider，在ConsumerComponent21和ConsumerComponent22之间共享数据。</span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">MyContext.Provider</span> <span class="attr">value</span>=<span class="string">&#123;tempValue&#125;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;<span class="name">ConsumerComponent21</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    	// 在ConsumerComponent21中通过useContext(MyContext)订阅</span></span><br><span class="line"><span class="xml">                    	// 获取到的值为离自身最近的那个匹配的Provider中读取到的Context值,即tempValue</span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;/<span class="name">ConsumerComponent21</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;<span class="name">ConsumerComponent22</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;/<span class="name">ConsumerComponent22</span>&gt;</span></span></span><br><span class="line"><span class="xml">				&lt;/MyContext.Provider value=&#123;contextValue&#125;&gt;</span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;/<span class="name">ConsumerComponent2</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">ConsumerComponent3</span> /&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">MyContext.Provider</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;/<span class="name">App</span>&gt;</span></span></span><br><span class="line"><span class="xml">);</span></span><br><span class="line"><span class="xml"></span></span><br></pre></td></tr></table></figure>





<h2 id="官方文档"><a href="#官方文档" class="headerlink" title="官方文档"></a>官方文档</h2><p>官方文档请参考下边的基础和高级教程。</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://zh-hans.reactjs.org/docs/hooks-reference.html#usecontext">Hook API 索引 – React (reactjs.org)</a> </li>
<li><a target="_blank" rel="noopener" href="https://zh-hans.reactjs.org/docs/context.html">Context – React (reactjs.org)</a> </li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh">
    <link itemprop="mainEntityOfPage" href="https://moakap.github.io/2021/05/24/about/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="moakap">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Moakap's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/05/24/about/" class="post-title-link" itemprop="url">about</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2021-05-24 18:52:51" itemprop="dateCreated datePublished" datetime="2021-05-24T18:52:51+00:00">2021-05-24</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2021-05-28 01:18:09" itemprop="dateModified" datetime="2021-05-28T01:18:09+00:00">2021-05-28</time>
              </span>

          
            <span id="/2021/05/24/about/" class="post-meta-item leancloud_visitors" data-flag-title="about" title="Views">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">Views: </span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine: </span>
    
    <a title="valine" href="/2021/05/24/about/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2021/05/24/about/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh">
    <link itemprop="mainEntityOfPage" href="https://moakap.github.io/2021/05/24/Expo/Assets-in-Expo/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="moakap">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Moakap's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/05/24/Expo/Assets-in-Expo/" class="post-title-link" itemprop="url">Expo中的Assets资源使用</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2021-05-24 11:52:51" itemprop="dateCreated datePublished" datetime="2021-05-24T11:52:51+00:00">2021-05-24</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2021-05-28 01:18:09" itemprop="dateModified" datetime="2021-05-28T01:18:09+00:00">2021-05-28</time>
              </span>

          
            <span id="/2021/05/24/Expo/Assets-in-Expo/" class="post-meta-item leancloud_visitors" data-flag-title="Expo中的Assets资源使用" title="Views">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">Views: </span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine: </span>
    
    <a title="valine" href="/2021/05/24/Expo/Assets-in-Expo/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2021/05/24/Expo/Assets-in-Expo/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>图片、字体、视频、音频和其它你的App里用到的不是JavaScript的文件都被认为是资源(asset). 就比如说在在互联网上， 所有你通过http传输获取的东西叫资源。这一点跟移动app不同，在app里资源一般跟app本身的二进制文件打包在一起。</p>
<p>然而，在Expo中通过<code>require</code>引用的资源（例如<code>&lt;Image source=&#123;require(&#39;./assets/images/example.png&#39;)&#125; /&gt;</code>在编译的时候已经在本地文件系统存在了）跟在web中通过URL引用的资源（例如<code>&lt;Image source=&#123;&#123;uri: 'http://yourwebsite.com/logo.png'&#125;&#125; /&gt;</code>）是有区别的。Expo不保证通过web URL引用的这些资源的可用性，因为这些资源不在Expo的管理范围。另外，Expo本身无法获取任意Web URL的全部信息。当你的资源存在于本地文件系统的时候，打包器能够读取资源的基本元数据metadata，比如宽度、高度，然后将这些信息传递给你的App，所以你不需要明确指明某个图片的宽度和高度。然而当你使用远程web URL引用资源的时候，你就必须明确得指明宽度、高度这些信息，否则系统会默认使用0x0。 最后，我们也会看到两者的缓存机制也不同。</p>
<p>接下来是对<code>require</code>类型资源得详细解释，这些资源必须在编译的时候就已经在文件系统存在。而在通过远程URL引用图片资源的例子中，系统默认你知道怎么将一个图片上传到网络，并确保能够被web和移动App访问。</p>
<h2 id="资源的位置"><a href="#资源的位置" class="headerlink" title="资源的位置"></a>资源的位置</h2><h3 id="开发环境"><a href="#开发环境" class="headerlink" title="开发环境"></a>开发环境</h3><p>当你工作在项目的本地开发环境时，所有资源被存放在本地文件系统，并且集成到JavaScript的模块中。所以如果想要包含某个图片，你可以直接在javascript中使用<code>require</code>引用，像这样<code>require(&#39;./assets/images/example.png&#39;)</code>。这里唯一的不同是，你必须指定资源的文件后缀；没有后缀的话，系统会默认这是一个javascript文件。下边这个语句会在编译的时候把资源连同资源的元数据一起赋值给一个对象，然后整个对象传递给<code>Image</code>组件做渲染。</p>
<p><code>&lt;Image source=&#123;require(&#39;./assets/images/example.png&#39;)&#125; /&gt;</code></p>
<h3 id="生产环境"><a href="#生产环境" class="headerlink" title="生产环境"></a>生产环境</h3><p>每次你通过Expo发布App的时候，Expo都会把所有需要的资源上传到Amazon CloudFront，一个快速的CDN。而且整个上传过程会非常智能，没有变化的资源会被跳过。整个过程都由Expo自动完成，不需要开发者任何操作。</p>
<h2 id="自定义支持的资源扩展"><a href="#自定义支持的资源扩展" class="headerlink" title="自定义支持的资源扩展"></a>自定义支持的资源扩展</h2><p>有时候你需要用到的文件类型不在Expo默认的支持范围。例如，如果你想要在App中导入数据库，就可能会用到.db文件。参考<a target="_blank" rel="noopener" href="https://docs.expo.io/guides/customizing-metro/">自定义Metro</a>了解如何通过Metro自定义iOS和Android资源扩展，参考<a target="_blank" rel="noopener" href="https://docs.expo.io/guides/customizing-webpack/">自定义Webpack</a>了解如何通过Webpack自定义Web资源扩展。</p>
<h2 id="优化"><a href="#优化" class="headerlink" title="优化"></a>优化</h2><h3 id="图片"><a href="#图片" class="headerlink" title="图片"></a>图片</h3><p>图片一般是Expo项目中占用空间最多的资源。优化图片可以减少用户设备上的空间占用，从而降低显示前的加载时间和使用带宽。可以通过执行<code>npx expo-optimize</code>命令来压缩PNG和JPEG图片。也可以设置下边的选项：</p>
<ul>
<li><code>--save</code>: 备份所有图片（以<code>.orig</code>文件的形式保存）</li>
<li><code>--quality=N</code>: 设置文件压缩比率，N可以是1-100之间的整数（包含1和100，默认为60）</li>
<li><code>--include=&quot;[pattern]&quot;</code>: 设置仅优化满足通配符模式的资源（默认使用app.json中的<code>assetBundlePatterns</code>字段）</li>
<li><code>--exclude=&quot;[pattern]&quot;</code>: 排除满足通配符模式的资源</li>
</ul>
<p>注意：所有通配符得匹配范围都是相对于项目的根目录，跟执行命令所在的目录无关。</p>
<h3 id="字体"><a href="#字体" class="headerlink" title="字体"></a>字体</h3><p>字体是启动App必不可缺的资源。web应用中的字体加载问题分为FOUT (Flash of Unstyled Text), FOIT (Flash of Invisible Text), FOFT (Flash of Faux Text)这几种，详细可以参考<a target="_blank" rel="noopener" href="https://css-tricks.com/fout-foit-foft/">这里</a>。</p>
<p>icon-font-powered的默认行为是第一次加载的时候使用FOIT，然后在后续的加载中字体会自动被缓存。相比较于传统Web，在用户对移动设备有更高的标准要求，所以你可能需要在初始屏幕加载的过程中预加载和缓存字体和一些重要的图片。</p>
<h3 id="缓存"><a href="#缓存" class="headerlink" title="缓存"></a>缓存</h3><p>参考[这里](<a target="_blank" rel="noopener" href="https://docs.expo.io/guides/preloading-and-caching-assets/">Asset Caching - Expo Documentation</a>)了解更多资源缓存的话题。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">moakap</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">7</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-tags">
        <span class="site-state-item-count">8</span>
        <span class="site-state-item-name">tags</span>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/moakap" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;moakap" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">moakap</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://mist.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Mist</a>
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  






  <script>
    (function(d, w, c) {
      w.ChatraID = '8bJkPKgPL44u2PqrC';
      var s = d.createElement('script');
      w[c] = w[c] || function() {
        (w[c].q = w[c].q || []).push(arguments);
      };
      s.async = true;
      s.src = 'https://call.chatra.io/chatra.js';
      if (d.head) d.head.appendChild(s);
    })(document, window, 'Chatra');
  </script>







<script>
if (document.querySelectorAll('pre.mermaid').length) {
  NexT.utils.getScript('//cdn.jsdelivr.net/npm/mermaid@8/dist/mermaid.min.js', () => {
    mermaid.initialize({
      theme    : 'forest',
      logLevel : 3,
      flowchart: { curve     : 'linear' },
      gantt    : { axisFormat: '%m/%d/%Y' },
      sequence : { actorMargin: 50 }
    });
  }, window.mermaid);
}
</script>


  

  


<script>
NexT.utils.loadComments(document.querySelector('#valine-comments'), () => {
  NexT.utils.getScript('//unpkg.com/valine/dist/Valine.min.js', () => {
    var GUEST = ['nick', 'mail', 'link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item => {
      return GUEST.includes(item);
    });
    new Valine({
      el         : '#valine-comments',
      verify     : false,
      notify     : false,
      appId      : 'AjpQWK4TAFokhRL5FftLIpHr-gzGzoHsz',
      appKey     : 'Lt5JkPmORcKiBCx0RvGPVcNP',
      placeholder: "Just go go",
      avatar     : 'mm',
      meta       : guest,
      pageSize   : '10' || 10,
      visitor    : true,
      lang       : 'zh-cn' || 'zh-cn',
      path       : location.pathname,
      recordIP   : true,
      serverURLs : ''
    });
  }, window.Valine);
});
</script>

</body>
</html>
