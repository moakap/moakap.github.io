---
title: 在Swarm存储数据
default_category: Swarm
categories:
  - technology
  - Swarm
tags: 
  - Swarm
  - Bee
  - Stamps
date: 2021-06-06 11:00:51

---

## 保持Swarm数据活跃

Swarm中包括了网络中所有节点的所有存储空间，也叫做DISC（分布式不可更改存储数据块）。只有拥有数据块 对应的邮票的节点拥有写入权限。



#### 节点钱包充值

要启动Bee节点，你应该已经提供了相应数量的gETH（用作gas费用）和gBZZ（用作跟其它节点交换数据）。这些会在你的节点第一次启动的时候转入到节点对应的支票地址。为了能够接入更多存款买更多票据块，你就需要给你的钱包充入gBZZ。最简单的方法就是直接从你的支票本中提现。

```shell
curl -XPOST "http://localhost:1635/chequebook/withdraw/?amount=1000"
```



### 充值票据

邮票根据数据块分组/批产生，这样存储节点可以根据本地信息计算数据块相关的邮票的有效性。这样也可以保证Swarm中数据的隐私性。

整个swarm地址空间被分成2^16也就是65536个不同的数据桶（bucket）。所以票据组默认会被创建在这些数据桶中（深度16）。当上传数据时，每个文件为被拆分成大小为4kb的数据区块（chunk），这些数据库根据地址分属于对应的数据桶。

创建票据组时需要指定两个值，票据组深度和金额。

#### 金额

金额表示当前票据组代表的gBZZ数量。购买整个票据组需要支付的gBZZ会根据这个金额和票据组深度来计算。

支付金额形成了当前票据组的余额。余额会随着时间和数据块在Goerli区块链中的使用逐渐减少。

#### 票据组深度

票据组的深度定义了每个数据桶可以分配的数据块(chunk)数量。每个数据桶中的数据块数量  = ```2^(batch depth - bucket depth) = 2^(batch depth - 16)```. 

#### 票据组深度和数量的计算

邮票是Swarm中最新引入的功能，主要考虑如何更好的使用票据组，还处于早起概念阶段。

现在，开始上传内容的最简单方法就是购买足够大的票据组。否则，如果数据组不够大，就会出现过多的数据块被分配到同一个数据桶的情况。

具体的数据取决于你想要在swarm中保存数据的时长。由于价格的波动，很难准确预测你的数据块会耗尽所有余额；然而可以根据当前价格和剩余金额来大概估算。

就当前情况，我们建议你为票据组设置深度为20，至少10000000数量。这应该可以允许你上传相当一些数据，并且保证在可见的将来这些文件一直保存在Swarm中。

注意：当购买邮票时，默认你已经同意从账户中消耗相应数量的gBZZ。尽管你的账户余额会随着时间逐渐减少，票据组中的gBZZ无法取现。这也是Swarm分布式设计思想的结果，具体参考Swarm白皮书。

```curl -s -XPOST http://localhost:1633/stamps/10000000/20```

购买了票据组后，其它Bee节点需要同步并且注册相应的票据组。取决于网络状况，这个同步过程可能需要几分钟时间 。

### 计算票据组余额

你的票据组需要保持足够的余额，以便其它Bee节点依据“邻里规范”为你的数据提供存储和服务。因此你需要定期检查余额，并根据需要充值。

```curl localhost:1635/chainstate```

以上命令会显示当前数据块的单价（单位GPLUR, GBZZ的最小单位）。

不就的将来，这个功能会加入到账户总票据信息中。当前这个阶段，你需要针对每个新创建的票据组ID重新上传内容。
